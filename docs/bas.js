!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("BasDanmaku",[],e):"object"==typeof exports?exports.BasDanmaku=e():t.BasDanmaku=e()}("undefined"!=typeof self?self:this,function(){return function(t){function e(r){if(a[r])return a[r].exports;var s=a[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var a={};return e.m=t,e.c=a,e.d=function(t,a,r){e.o(t,a)||Object.defineProperty(t,a,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(a,"a",a),a},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,a){"use strict";e.a={extend:function(t,e){var a={};for(var r in t)t.hasOwnProperty(r)&&(a[r]=t[r]);for(var r in e)e.hasOwnProperty(r)&&(a[r]=e[r]);return a},escapeSpecialChars:function(t){return t.replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\f/g,"\\f")},nowTime:function(){return performance?performance.now():+new Date},string2DOM:function(t){return $(t)[0]},colorFromInt:function(t){return"#"+("00000"+t.toString(16)).slice(-6)},rgbaFormat:function(t,e){var a=("00000"+t.toString(16)).slice(-6);return"rgba("+parseInt(a.slice(0,2),16)+","+parseInt(a.slice(2,4),16)+","+parseInt(a.slice(4,6),16)+","+e+")"},htmlEncode:function(t,e){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2f;").replace(/ /g,e?" ":"&nbsp;").replace(/\n/g,"<br>")}}},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a(2),s=(a.n(r),a(0)),n=a(7),i=a(8),o=a(10),p=function(){function t(t,e){void 0===t&&(t={}),this.paused=!0,this.sTime=0,this.inited=!1,this.dmList=[],this.cdmList=[],this.dmIndex=0,this.cTime=0,this.pTime=0,this.time0=0,this.pauseTime=0,this.testId=0,this.testDanmakus=[];var a={container:document.getElementById("player"),easing:"linear",visible:!0,fontFamily:"",timeSyncFunc:null};this.options=s.a.extend(a,t),this.player=e,this.defaultCommon={x:{numType:"number",value:0},y:{numType:"number",value:0},zIndex:0,scale:{numType:"number",value:1},duration:void 0},this.defaultText={content:"\u8bf7\u8f93\u5165\u5185\u5bb9",alpha:{numType:"number",value:1},color:16777215,anchorX:{numType:"number",value:0},anchorY:{numType:"number",value:0},fontSize:{numType:"number",value:25},fontFamily:this.options.fontFamily,bold:1,textShadow:1,strokeWidth:0,strokeColor:16777215,rotateX:{numType:"number",value:0},rotateY:{numType:"number",value:0},rotateZ:{numType:"number",value:0},parent:void 0},this.defaultButton={text:"\u8bf7\u8f93\u5165\u5185\u5bb9",fontSize:{numType:"number",value:25},textColor:0,textAlpha:{numType:"number",value:1},fillColor:16777215,fillAlpha:{numType:"number",value:1},target:void 0},this.defaultPath={d:void 0,viewBox:void 0,borderColor:0,borderAlpha:{numType:"number",value:1},borderWidth:{numType:"number",value:0},fillColor:16777215,fillAlpha:{numType:"number",value:1}},this.container=this.options.container,this.paused=!0,this.sTime=0,this.inited=!1,this.dmList=[],this.cdmList=[],this.dmIndex=0,this.visibleStatus=this.options.visible,this.cTime=0,this.pTime=0,this.time0=0,this.pauseTime=0,this.startTime=(new Date).getTime(),this.testId=0}return t.prototype.init=function(){var t=this;this.wrap=s.a.string2DOM('<div class="bas-danmaku '+(this.paused?"bas-danmaku-pause":"")+'"></div>'),this.container&&this.container.appendChild(this.wrap),this.inited=!0,this.resolutionWidth&&this.resolutionHeight&&this.resize(),window.requestAnimationFrame(function(){t.render()})},t.prototype.add=function(t,e,a){void 0===e&&(e=!1),void 0===a&&(a=!1);var r=e?t:this.parse(t);r&&(this.inited||this.init(),a?(r.dmid="test"+this.testId++,r.test=!0,r.stime=this.options.timeSyncFunc()/1e3,this.pretreatDanmaku(r),this.testDanmakus.push(r),this.drawDanmaku(r)):(this.pretreatDanmaku(r),-1===r.stime&&(this.cTime?r.stime=this.cTime/1e3+.1:r.stime=this.options.timeSyncFunc()/1e3+.1),this.dmList.push(r),1!==this.dmList.length||this.paused||this.play()))},t.prototype.pretreatDanmaku=function(t){t.def2set={};for(var e=0;e<t.defs.length;e++){var a=t.defs[e].name,r=0;t.def2set[a]=[];for(var n=0;n<t.sets.length;n++)switch(t.sets[n].type){case"Serial":for(var i=0,o=0;o<t.sets[n].items.length;o++)t.sets[n].items[o].targetName===a&&(t.def2set[a].push({name:"bas-"+t.dmid+"-"+a+"-"+r,valueStart:this.getValueStart(o,r,t.def2set[a]),valueEnd:s.a.extend(this.getValueStart(o,r,t.def2set[a]),t.sets[n].items[o].attrs),easing:t.sets[n].items[o].defaultEasing||this.options.easing||"linear",duration:t.sets[n].items[o].duration/1e3,delay:i/1e3,group:n}),r++),i+=t.sets[n].items[o].duration;break;case"Parallel":for(var o=0;o<t.sets[n].items.length;o++)t.sets[n].items[o].targetName===a&&(t.def2set[a].push({name:"bas-"+t.dmid+"-"+a+"-"+r,valueEnd:s.a.extend(this.getValueStart(o,r,t.def2set[a]),t.sets[n].items[o].attrs),easing:t.sets[n].items[o].defaultEasing||this.options.easing||"linear",duration:t.sets[n].items[o].duration/1e3,delay:0}),r++);break;case"Unit":t.sets[n].targetName===a&&(t.def2set[a].push({name:"bas-"+t.dmid+"-"+a+"-"+r,valueEnd:t.sets[n].attrs,easing:t.sets[n].defaultEasing||this.options.easing||"linear",duration:t.sets[n].duration/1e3,delay:0}),r++)}}for(var p in t.def2set)!function(e){if(t.def2set.hasOwnProperty(e)){var a=t.defs.filter(function(t){return t.name===e})[0];a.attrs.duration?t.def2set[e].push({name:"bas-"+t.dmid+"-"+e+"-duration",valueEnd:{},easing:"linear",duration:a.attrs.duration/1e3,delay:0}):0===t.def2set[e].length&&t.def2set[e].push({name:"bas-"+t.dmid+"-"+e+"-0",valueEnd:{},easing:"linear",duration:4,delay:0})}}(p);t.duration=0;for(var u in t.def2set)!function(e){if(t.def2set.hasOwnProperty(e)){for(var a=0;a<t.def2set[e].length;a++){var r=t.def2set[e][a].delay+t.def2set[e][a].duration;r>t.duration&&(t.duration=r)}t.setsIntervals={};for(var a=t.def2set[e].length-1;a>=0;a--)!function(a){var r=[t.def2set[e][a].delay,t.def2set[e][a].delay+t.def2set[e][a].duration,t.def2set[e][a].group];for(var s in t.def2set[e][a].valueEnd)if(t.def2set[e][a].valueEnd.hasOwnProperty(s))if(-1!==["x","y","rotateX","rotateY","rotateZ","scale"].indexOf(s)&&(s="transform"),t.setsIntervals[s])for(var n=t.setsIntervals[s].length,i=0;i<n;i++)t.setsIntervals[s][i]&&(t.setsIntervals[s][i][0]>r[0]&&t.setsIntervals[s][i][0]<r[1]||t.setsIntervals[s][i][1]>r[0]&&t.setsIntervals[s][i][1]<r[1]?(t.def2set[e]=t.def2set[e].filter(function(r){return r.group!==t.def2set[e][a].group}),t.setsIntervals[s]=t.setsIntervals[s].filter(function(r){return r[2]!==t.def2set[e][a].group})):t.setsIntervals[s].push(r));else t.setsIntervals[s]=[r]}(a)}}(u)},t.prototype.getValueStart=function(t,e,a){return t>=1&&e>=1?a[e-1].valueEnd&&Object.keys(a[e-1].valueEnd).length?a[e-1].valueEnd:this.getValueStart(t-1,e-1,a):null},t.prototype.parse=function(t){try{var e=new o.a(i.a.parse(t.text)).transform();t.defs=e.defs;for(var a=0;a<e.defs.length;a++)t.defs[a].attrs=s.a.extend(this.defaultCommon,e.defs[a].attrs),"DefText"===t.defs[a].type?t.defs[a].attrs=s.a.extend(this.defaultText,e.defs[a].attrs):"DefButton"===t.defs[a].type?t.defs[a].attrs=s.a.extend(this.defaultButton,e.defs[a].attrs):"DefPath"===t.defs[a].type&&(t.defs[a].attrs=s.a.extend(this.defaultPath,e.defs[a].attrs));return t.sets=e.sets,t}catch(t){throw console.log("Error in parse Bas: ",t),new Error(t.message)}},t.prototype.render=function(){var t=this;this.paused||(window.requestAnimationFrame(function(){t.render()}),this.renderDanmaku())},t.prototype.renderDanmaku=function(){this.updateTime(),this.refreshCdmList(),this.drawDanmaku()},t.prototype.updateTime=function(){this.pTime=this.cTime;var t=(new Date).getTime();this.cTime=this.time0+t-this.startTime;if("function"==typeof this.options.timeSyncFunc){var e=this.options.timeSyncFunc();(Math.abs(e-this.cTime)>1e3||isNaN(this.cTime))&&(this.cTime=e,this.pTime=e,this.time0=e,this.startTime=t,this.clear())}},t.prototype.refreshCdmList=function(){if(this.cdmList=[],Math.abs(this.cTime-this.pTime)<500)for(var t=0;t<this.dmList.length;t++)this.dmList[t].stime>=this.pTime/1e3&&this.dmList[t].stime<this.cTime/1e3&&this.cdmList.push(this.dmList[t])},t.prototype.drawDanmaku=function(t,e){var a=this;if(void 0===t&&(t=this.cdmList),void 0===e&&(e=0),this.visibleStatus)if(this.inited||this.init(),t instanceof Array)t.forEach(function(t){a.drawDanmaku(t)});else{var r=$.extend(!0,{},t),s=this,i=new n.a({container:this.wrap,dm:r,startTime:e,animationEndCallback:function(t){t.dm.test&&(s.testDanmakus=s.testDanmakus.filter(function(e){return e.dmid!==t.dm.dmid}))},player:this.player});i.ele&&this.wrap.appendChild(i.ele)}},t.prototype.play=function(){this.time0=this.pauseTime,this.startTime=(new Date).getTime(),this.pauseTime=0,this.paused=!1,this.wrap&&this.wrap.classList.remove("bas-danmaku-pause"),this.dmList.length&&(this.inited||this.init(),this.render())},t.prototype.pause=function(){this.paused=!0,this.inited||this.init(),this.wrap.classList.add("bas-danmaku-pause");var t=(new Date).getTime();this.pauseTime=this.time0+t-this.startTime},t.prototype.toggle=function(){this.paused?this.play():this.pause()},t.prototype.seek=function(t,e){void 0===e&&(e=!0),this.testDanmakus=[],this.time0=1e3*t,this.startTime=(new Date).getTime(),this.inited||this.init(),this.dmList.length&&this.visibleStatus&&this.wrap&&(this.pTime=1e3*t,this.cTime=1e3*t,this.clear(),e&&this.refresh())},t.prototype.refresh=function(){this.clear();for(var t=this.pTime/1e3,e=0;e<this.dmList.length;e++)this.dmList[e].stime<t&&this.dmList[e].stime+this.dmList[e].duration>t&&this.drawDanmaku(this.dmList[e],t-this.dmList[e].stime);for(var e=0;e<this.testDanmakus.length;e++)this.testDanmakus[e].stime<t&&this.testDanmakus[e].stime+this.testDanmakus[e].duration>t&&this.drawDanmaku(this.testDanmakus[e],t-this.testDanmakus[e].stime)},t.prototype.visible=function(t){t!==this.visibleStatus&&(t?(this.visibleStatus=!0,this.render()):(this.visibleStatus=!1,this.clear()))},t.prototype.clear=function(){this.inited&&(this.cdmList=[],this.wrap&&(this.wrap.innerHTML=""))},t.prototype.resize=function(t,e){if(void 0===t&&(t=this.resolutionWidth),void 0===e&&(e=this.resolutionHeight),this.resolutionWidth=t,this.resolutionHeight=e,this.inited){var a=this.container.offsetWidth,r=this.container.offsetHeight;a/t>r/e?(this.wrap.style.width=r/e*t/a*100+"%",this.wrap.style.height="100%"):(this.wrap.style.width="100%",this.wrap.style.height=a/t*e/r*100+"%")}this.refresh()},t}();e.default=p},function(t,e,a){var r=a(3);"string"==typeof r&&(r=[[t.i,r,""]]);var s={attrs:{"data-injector":"bilibili-player"},hmr:!0};s.transform=void 0;a(5)(r,s);r.locals&&(t.exports=r.locals)},function(t,e,a){e=t.exports=a(4)(!1),e.push([t.i,".bas-danmaku{pointer-events:none;user-select:none;position:absolute;transform:translate(-50%,-50%);left:50%;top:50%;box-sizing:border-box;width:100%;height:100%;background:transparent;z-index:10}.bas-danmaku.bas-danmaku-pause .bas-danmaku-item{animation-play-state:paused}.bas-danmaku>canvas{pointer-events:auto}.bas-danmaku-item{pointer-events:none;user-select:none;position:absolute;animation-fill-mode:forwards;-webkit-animation-fill-mode:forwards;line-height:1}.bas-danmaku-item .bas-danmaku-item{position:absolute;left:0;top:0}.bas-danmaku-item.bas-danmaku-item-button{pointer-events:auto;padding:10px 20px;border-radius:3px}.bas-danmaku-item-wrap{pointer-events:none;user-select:none;position:absolute;left:0;right:0;top:0;height:100%;z-index:10}.bas-danmaku-item-inner{border:0}",""])},function(t,e,a){"use strict";function r(t,e){var a=t[1]||"",r=t[3];if(!r)return a;if(e&&"function"==typeof btoa){var n=s(r);return[a].concat(r.sources.map(function(t){return"/*# sourceURL="+r.sourceRoot+t+" */"})).concat([n]).join("\n")}return[a].join("\n")}function s(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var a=r(e,t);return e[2]?"@media "+e[2]+"{"+a+"}":a}).join("")},e.i=function(t,a){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},s=0;s<this.length;s++){var n=this[s][0];"number"==typeof n&&(r[n]=!0)}for(s=0;s<t.length;s++){var i=t[s];"number"==typeof i[0]&&r[i[0]]||(a&&!i[2]?i[2]=a:a&&(i[2]="("+i[2]+") and ("+a+")"),e.push(i))}},e}},function(t,e,a){function r(t,e){for(var a=0;a<t.length;a++){var r=t[a],s=d[r.id];if(s){s.refs++;for(var n=0;n<s.parts.length;n++)s.parts[n](r.parts[n]);for(;n<r.parts.length;n++)s.parts.push(l(r.parts[n],e))}else{for(var i=[],n=0;n<r.parts.length;n++)i.push(l(r.parts[n],e));d[r.id]={id:r.id,refs:1,parts:i}}}}function s(t,e){for(var a=[],r={},s=0;s<t.length;s++){var n=t[s],i=e.base?n[0]+e.base:n[0],o=n[1],p=n[2],u=n[3],l={css:o,media:p,sourceMap:u};r[i]?r[i].parts.push(l):a.push(r[i]={id:i,parts:[l]})}return a}function n(t,e){var a=v(t.insertInto);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=g[g.length-1];if("top"===t.insertAt)r?r.nextSibling?a.insertBefore(e,r.nextSibling):a.appendChild(e):a.insertBefore(e,a.firstChild),g.push(e);else if("bottom"===t.insertAt)a.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var s=v(t.insertInto+" "+t.insertAt.before);a.insertBefore(e,s)}}function i(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=g.indexOf(t);e>=0&&g.splice(e,1)}function o(t){var e=document.createElement("style");return t.attrs.type="text/css",u(e,t.attrs),n(t,e),e}function p(t){var e=document.createElement("link");return t.attrs.type="text/css",t.attrs.rel="stylesheet",u(e,t.attrs),n(t,e),e}function u(t,e){Object.keys(e).forEach(function(a){t.setAttribute(a,e[a])})}function l(t,e){var a,r,s,n;if(e.transform&&t.css){if(!(n=e.transform(t.css)))return function(){};t.css=n}if(e.singleton){var u=y++;a=b||(b=o(e)),r=h.bind(null,a,u,!1),s=h.bind(null,a,u,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(a=p(e),r=f.bind(null,a,e),s=function(){i(a),a.href&&URL.revokeObjectURL(a.href)}):(a=o(e),r=c.bind(null,a),s=function(){i(a)});return r(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;r(t=e)}else s()}}function h(t,e,a,r){var s=a?"":r.css;if(t.styleSheet)t.styleSheet.cssText=x(e,s);else{var n=document.createTextNode(s),i=t.childNodes;i[e]&&t.removeChild(i[e]),i.length?t.insertBefore(n,i[e]):t.appendChild(n)}}function c(t,e){var a=e.css,r=e.media;if(r&&t.setAttribute("media",r),t.styleSheet)t.styleSheet.cssText=a;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(a))}}function f(t,e,a){var r=a.css,s=a.sourceMap,n=void 0===e.convertToAbsoluteUrls&&s;(e.convertToAbsoluteUrls||n)&&(r=k(r)),s&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */");var i=new Blob([r],{type:"text/css"}),o=t.href;t.href=URL.createObjectURL(i),o&&URL.revokeObjectURL(o)}var d={},m=function(t){var e;return function(){return void 0===e&&(e=t.apply(this,arguments)),e}}(function(){return window&&document&&document.all&&!window.atob}),v=function(t){var e={};return function(a){if(void 0===e[a]){var r=t.call(this,a);if(r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}e[a]=r}return e[a]}}(function(t){return document.querySelector(t)}),b=null,y=0,g=[],k=a(6);t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");e=e||{},e.attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||(e.singleton=m()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var a=s(t,e);return r(a,e),function(t){for(var n=[],i=0;i<a.length;i++){var o=a[i],p=d[o.id];p.refs--,n.push(p)}if(t){r(s(t,e),e)}for(var i=0;i<n.length;i++){var p=n[i];if(0===p.refs){for(var u=0;u<p.parts.length;u++)p.parts[u]();delete d[p.id]}}}};var x=function(){var t=[];return function(e,a){return t[e]=a,t.filter(Boolean).join("\n")}}()},function(t,e,a){"use strict";t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var a=e.protocol+"//"+e.host,r=a+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var s=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});if(/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/)/i.test(s))return t;var n;return n=0===s.indexOf("//")?s:0===s.indexOf("/")?a+s:r+s.replace(/^\.\//,""),"url("+JSON.stringify(n)+")"})}},function(t,e,a){"use strict";var r=a(0),s=function(){function t(t){this.prefix=["","-webkit-"],this.endProgress={},this.xProportion=t.container.offsetWidth/100,this.yProportion=t.container.offsetHeight/100,this.container=t.container,this.dm=t.dm,this.percentObj2Num(this.dm),this.defs=this.dm.defs,this.sets=this.dm.sets,this.startTime=t.startTime,this.player=t.player,this.animationEndCallback=t.animationEndCallback,this.init()}return t.prototype.init=function(){var t=this.itemsTemplate();if(t){var e=100*this.xProportion/2/Math.tan(Math.PI/180*27.5);this.ele=r.a.string2DOM('<div class="bas-danmaku-item-wrap" style="perspective:'+e+"px;-webkit-perspective:"+e+'px;">'+this.animationTemplate()+t+"</div>");for(var a=0;a<this.defs.length;a++){var s=this.defs[a].name;this.endProgress[s]=0,this.transience(s)}this.bindEvents(this.ele)}},t.prototype.animationCallback=function(t){var e=t.animationName.split("-")[2];this.endProgress[e]?this.endProgress[e]++:this.endProgress[e]=1,this.transience(e),this.animationEndCallback(this),this.endProgress[e]!==this.dm.def2set[e].length&&"duration"!==t.animationName.split("-")[3]||(t.target.parentNode.removeChild(t.target),0===this.ele.getElementsByClassName("bas-danmaku-item").length&&this.container.removeChild(this.ele))},t.prototype.transience=function(t){var e=this.endProgress[t],a=this.dm.def2set[t][e];if(a&&a.valueEnd&&(a.valueEnd.content&&(this.ele.querySelector(".bas-danmaku-item--"+t+" .bas-danmaku-item-inner").innerHTML=a.valueEnd.content.value),a.valueEnd.text&&(this.ele.querySelector(".bas-danmaku-item--"+t+" .bas-danmaku-item-inner").innerHTML=a.valueEnd.text.value),a.valueEnd.fontSize)){var r=a.valueEnd.fontSize.value;r>=12?this.ele.querySelector(".bas-danmaku-item--"+t+" .bas-danmaku-item-inner").style.fontSize=r+"px":(this.ele.querySelector(".bas-danmaku-item--"+t+" .bas-danmaku-item-inner").style.fontSize="12px",this.ele.querySelector(".bas-danmaku-item--"+t+" .bas-danmaku-item-inner").style.transform="scale("+r/12+")")}},t.prototype.percentObj2Num=function(t){for(var e=this,a=function(t){for(var a in t)if(t.hasOwnProperty(a)){var r=void 0;if(t[a].numType)r=t[a];else{if(!t[a].value||!t[a].value.numType)continue;r=t[a].value}if("number"===r.numType)switch(a){case"x":r=r.value/e.xProportion;break;case"y":r=r.value/e.yProportion;break;default:r=r.value}else if("percent"===r.numType)switch(a){case"fontSize":case"width":r=r.value*e.xProportion;break;case"height":r=r.value*e.yProportion;break;default:r=r.value}t[a].numType?t[a]=r:t[a].value&&t[a].value.numType&&(t[a].value=r)}},r=0;r<t.defs.length;r++)a(t.defs[r].attrs);for(var r=0;r<t.sets.length;r++)if(t.sets[r].items)for(var s=0;s<t.sets[r].items.length;s++)a(t.sets[r].items[s].attrs);else a(t.sets[r].attrs);for(var n in t.def2set)if(t.def2set.hasOwnProperty(n))for(var r=0;r<t.def2set[n].length;r++)a(t.def2set[n][r].valueEnd),a(t.def2set[n][r].valueStart)},t.prototype.itemsTemplate=function(){for(var t="",e=0;e<this.defs.length;e++)this.defs[e].attrs.parent||(t+=this.itemsTemplateOne(this.defs[e]));return t},t.prototype.itemsTemplateOne=function(t,e,a){var s=this;void 0===e&&(e=this.xProportion),void 0===a&&(a=this.yProportion);var n=function(t,e){for(var a="",r=0;r<t.length;r++)a+="duration"===e?t[r][e]+"s":"delay"===e?t[r][e]-s.startTime+"s":t[r][e],r!==t.length-1&&(a+=",");return a},i=t.attrs,o=this.dm.def2set[t.name],p=""+this.prefixCSS("animation-name",n(o,"name"))+this.prefixCSS("animation-duration",n(o,"duration"))+this.prefixCSS("animation-timing-function",n(o,"easing"))+this.prefixCSS("animation-delay",n(o,"delay"));for(var u in i)i.hasOwnProperty(u)&&(p+=this.getStyleOut(u,i[u]));var l;switch(t.type){case"DefText":p+="transform:translate("+i.x*e+"px, "+i.y*a+"px) rotateX("+i.rotateX+"deg) rotateY("+i.rotateY+"deg) rotateZ("+i.rotateZ+"deg) scale("+i.scale+");transform-origin:"+100*-i.anchorX+"% "+100*-i.anchorY+"%;",l="pointer-events:none;border-style:solid;-webkit-text-stroke:"+i.strokeWidth+"px "+r.a.colorFromInt(i.strokeColor)+";";for(var u in i)i.hasOwnProperty(u)&&(l+=this.getStyleIn(u,i[u]));for(var h="",u=0;u<this.defs.length;u++)this.defs[u].attrs.parent===t.name&&(this.defSize(t),h+=this.itemsTemplateOne(this.defs[u],t.attrs.width/100,t.attrs.height/100));return'<div class="bas-danmaku-item bas-danmaku-item-text bas-danmaku-item--'+t.name+'" style="'+p+'"><div class="bas-danmaku-item-inner" style="transform:translate('+100*-i.anchorX+"%,"+100*-i.anchorY+"%);"+l+'">'+i.content+h+"</div></div>";case"DefButton":p+="transform:translate("+i.x*e+"px, "+i.y*a+"px) scale("+i.scale+");color:"+r.a.rgbaFormat(i.textColor,i.textAlpha)+";background-color:"+r.a.rgbaFormat(i.fillColor,i.fillAlpha)+";",l="";for(var u in i)i.hasOwnProperty(u)&&(l+=this.getStyleIn(u,i[u]));return'<div class="bas-danmaku-item bas-danmaku-item-button bas-danmaku-item--'+t.name+'" style="'+p+'"><div class="bas-danmaku-item-inner" style="'+l+'">'+i.text+"</div></div>";case"DefPath":p+="transform:translate("+i.x*e+"px, "+i.y*a+"px);",l="";for(var u in i)i.hasOwnProperty(u)&&(l+=this.getStyleIn(u,i[u]));var c=void 0;i.viewBox?c=i.width||i.height?'viewBox="'+i.viewBox+'" '+(i.width?'width="'+i.width*(i.scale||1)+'"':"")+" "+(i.height?'height="'+i.height*(i.scale||1)+'"':""):'viewBox="'+i.viewBox+'" width="'+parseInt(i.viewBox.split(" ")[2],10)*(i.scale||1)+'"':i.scale&&(c='style="transform:scale('+i.scale+');transform-origin: 0 0;overflow:visible;"');var f='fill="'+r.a.rgbaFormat(i.fillColor,i.fillAlpha)+'" stroke="'+r.a.rgbaFormat(i.borderColor,i.borderAlpha)+'" stroke-width="'+i.borderWidth+'" d="'+i.d+'"';return'<div class="bas-danmaku-item bas-danmaku-item-path bas-danmaku-item--'+t.name+'" style="'+p+'"><div class="bas-danmaku-item-inner" style="'+l+'"><svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg" '+c+"><path "+f+"></svg></div></div>"}},t.prototype.findParent=function(t){for(var e=0;e<this.defs.length;e++)if(this.defs[e].name===t)return this.defs[e];return null},t.prototype.defSize=function(t){!t||t.attrs.width&&t.attrs.height||(this.measureCanvas||(this.measureCanvas=document.createElement("canvas").getContext("2d")),this.measureCanvas.font=(t.attrs.bold?"bold ":"")+" "+t.attrs.fontSize+"px "+t.attrs.fontFamily,t.attrs.width=this.measureCanvas.measureText(t.attrs.content).width,t.attrs.height=t.attrs.fontSize)},t.prototype.getStyleIn=function(t,e){switch(t){case"fontFamily":return"font-family:&quot;"+e+"&quot;;";case"textShadow":return"text-shadow:"+(e?"rgb(0, 0, 0) 1px 0px 1px, rgb(0, 0, 0) 0px 1px 1px, rgb(0, 0, 0) 0px -1px 1px, rgb(0, 0, 0) -1px 0px 1px":"none")+";";case"bold":return"font-weight:"+(e?"bold":"normal")+";";case"fontSize":return e>=12?"font-size:"+e+"px;":"font-size:12px;transform:scale("+e/12+");";default:return""}},t.prototype.getStyleOut=function(t,e){switch(t){case"alpha":return"opacity:"+e+";";case"color":return"color:"+r.a.colorFromInt(e)+";";case"zIndex":return"z-index:"+e+";";default:return""}},t.prototype.animationTemplate=function(){for(var t="",e=0;e<this.defs.length;e++)for(var a=this.dm.def2set[this.defs[e].name],r=0;r<a.length;r++)if(this.defs[e].attrs.parent){var s=this.findParent(this.defs[e].attrs.parent);s&&(this.defSize(s),t+=this.keyframesTemplate(this.defs[e],a[r].name,a[r].valueStart,a[r].valueEnd,s.attrs.width/100,s.attrs.height/100))}else t+=this.keyframesTemplate(this.defs[e],a[r].name,a[r].valueStart,a[r].valueEnd);return"<style>"+t+"</style>"},t.prototype.keyframesTemplate=function(t,e,a,r,s,n){void 0===s&&(s=this.xProportion),void 0===n&&(n=this.yProportion);var i="",o="",p=function(e){return r&&void 0!==r[e]?r[e].value:a&&void 0!==a[e]?a[e].value:t.attrs[e]?t.attrs[e]:0},u=p("x")*s,l=p("y")*n,h=p("rotateX"),c=p("rotateY"),f=p("rotateZ"),d="DefPath"===t.type?1:p("scale");if(!a||void 0===a.x&&void 0===a.y&&void 0===a.rotateX&&void 0===a.rotateY&&void 0===a.rotateZ&&void 0===a.scale){if(r&&(void 0!==r.x||void 0!==r.y||void 0!==r.rotateX||void 0!==r.rotateY||void 0!==r.rotateZ||void 0!==r.scale))switch(t.type){case"DefText":o+="transform:translate("+u+"px, "+l+"px) rotateX("+h+"deg) rotateY("+c+"deg) rotateZ("+f+"deg) scale("+d+");";break;case"DefButton":case"DefPath":o+="transform:translate("+u+"px, "+l+"px);"}}else{var m=function(e){return a[e]?a[e].value:t.attrs[e]?t.attrs[e]:0},v=m("x")*s,b=m("y")*n,y=m("rotateX"),g=m("rotateY"),k=m("rotateZ"),x="DefPath"===t.type?1:m("scale");switch(t.type){case"DefText":i+="transform:translate("+v+"px, "+b+"px) rotateX("+y+"deg) rotateY("+g+"deg) rotateZ("+k+"deg) scale("+x+");",o+="transform:translate("+u+"px, "+l+"px) rotateX("+h+"deg) rotateY("+c+"deg) rotateZ("+f+"deg) scale("+d+");";break;case"DefButton":case"DefPath":i+="transform:translate("+v+"px, "+b+"px);",o+="transform:translate("+u+"px, "+l+"px);"}}for(var w in a)a.hasOwnProperty(w)&&(i+=this.getStyleOut(w,a[w].value));for(var w in r)r.hasOwnProperty(w)&&(o+=this.getStyleOut(w,r[w].value));return o||(o="line-height:1;"),i?"\n@-webkit-keyframes "+e+" {\n    0% { "+i+" }\n    100% { "+o+" }\n}\n@keyframes "+e+" {\n    0% { "+i+" }\n    100% { "+o+" }\n}":"\n@-webkit-keyframes "+e+" {\n    100% { "+o+" }\n}\n@keyframes "+e+" {\n    100% { "+o+" }\n}"},t.prototype.prefixCSS=function(t,e){for(var a="",r=0;r<this.prefix.length;r++)a+=""+this.prefix[r]+t+":"+e+";";return a},t.prototype.bindEvents=function(t){var e=this;t.addEventListener("animationend",function(t){return e.animationCallback(t)}),t.addEventListener("webkitAnimationEnd",function(t){return e.animationCallback(t)});for(var a=this,r=0;r<this.defs.length;r++)!function(r){a.defs[r].attrs.target&&t.getElementsByClassName("bas-danmaku-item--"+a.defs[r].name)[0].addEventListener("click",function(){"av"===e.defs[r].attrs.target.objType?(window.open("//www.bilibili.com/video/av"+e.defs[r].attrs.target.av+"/index_"+e.defs[r].attrs.target.page+".html"+(e.defs[r].attrs.target.time?"?t="+e.defs[r].attrs.target.time/1e3:"")),e.player&&e.player.pause()):"bangumi"===e.defs[r].attrs.target.objType?(window.open("//bangumi.bilibili.com/anime/"+e.defs[r].attrs.target.seasonId+"/play"+(e.defs[r].attrs.target.time?"?t="+e.defs[r].attrs.target.time/1e3:"")+"#"+e.defs[r].attrs.target.episodeId),e.player&&e.player.pause()):"seek"===e.defs[r].attrs.target.objType&&e.player&&e.player.seek(e.defs[r].attrs.target.time/1e3)})}(r)},t.prototype.destroy=function(){},t}();e.a=s},function(t,e,a){"use strict";var r=a(9),s=function(){function t(){this.actionTable=[null,{0:6,1:1,2:2,35:14,38:48,7:4,8:8,9:10,10:12,44:44,45:38,46:54,47:52,73:86,70:46,24:42,71:50,27:40},{11:41,20:20,21:22,22:16,28:18},{32:26,19:28,42:24,35:14,29:32,30:30,31:73},{0:6,2:9,81:74,4:29,69:78,6:35,7:4,8:8,9:10,10:12,12:43,70:46,71:50,16:55,64:58,18:43,19:61,78:169,23:58,24:42,72:77,73:86,27:40,66:106,82:102,79:104,33:77,34:58,35:14,36:61,38:48,39:56,41:77,43:99,44:44,45:38,46:54,47:52,49:72,50:70,80:76,55:68,56:60,57:62,58:64,59:66,61:98,62:100},{10:39,3:27,35:14,29:27,30:39},{38:48,71:50,40:37,9:37,44:44,45:38,70:46,73:86,18:45,12:45,14:37,24:42,25:37,27:40},{32:26,35:14,68:159,69:78,73:86,42:24,67:112,44:129,83:110,80:76,49:72,50:70,19:28,84:108,55:68,81:74,59:66,29:32,30:30,31:75},{0:6,70:46,2:11,35:14,5:11,38:48,7:4,8:8,9:10,10:12,44:44,45:38,14:36,15:11,17:11,34:11,71:50,46:54,47:52,24:42,25:34,73:86,27:40},{0:6,2:13,5:13,70:46,7:4,8:8,9:10,10:12,13:49,14:36,15:13,17:13,71:50,25:34,26:71,27:40,24:42,34:13,35:14,73:86,38:48,44:44,45:38,46:54,47:52,48:131},{64:58,66:106,69:78,70:46,71:50,72:167,73:86,14:36,15:51,80:76,81:74,82:102,23:58,24:42,25:34,27:40,79:104,33:79,34:58,38:48,39:56,40:95,41:97,44:44,45:38,49:72,50:70,55:68,56:60,57:62,58:64,59:66,61:98,62:100},{78:101,43:101,54:101,38:91},{0:6,2:15,35:14,38:48,7:4,8:8,9:10,10:12,44:44,45:38,46:54,47:52,73:86,70:46,24:42,71:50,27:40},{37:89},{78:103,54:103,43:103},{78:84,51:80,52:82,60:141,43:84,54:84},{69:163},{78:105,54:105,43:105},{78:107,54:107,43:107},{78:109,43:109,54:109,63:109},{65:149,74:88,75:90,76:92,53:96,77:94},{65:151,74:88,75:90,76:92,53:96,77:94},{65:153,74:88,75:90,76:92,53:96,77:94},{65:155,74:88,75:90,76:92,53:96,77:94},{65:157,74:88,75:90,76:92,53:96,77:94},{43:111},{67:112,68:161,69:78,73:86,80:76,49:72,50:70,83:110,84:108,54:135,55:68,81:74,59:66}],this.gotoTable={27:{0:5},28:{0:7},29:{2:17},30:{2:19},31:{17:57,2:21,34:83,5:31,15:53},32:{36:63,2:23,19:63},33:{36:25,2:25,19:25},34:{19:65},35:{12:47,18:59},36:{36:87,19:67},37:{5:33},38:{64:147,34:85,23:69},39:{38:93},40:{63:143},41:{78:113,43:113,54:113,63:145},42:{72:81,33:81,41:81},43:{43:115},44:{78:171,54:137,43:117},45:{43:119},46:{78:121,54:121,43:121},47:{78:123,54:123,43:123},48:{69:165},49:{53:133},50:{43:125},51:{43:127},52:{54:139}},this.prodList=[[53,2],[27,1],[28,2],[28,0],[29,1],[29,1],[29,1],[32,4],[33,3],[33,3],[35,1],[35,1],[34,3],[34,1],[34,0],[36,1],[36,1],[37,2],[37,1],[31,6],[31,3],[31,3],[39,1],[39,3],[39,0],[40,1],[30,6],[30,6],[38,2],[38,0],[42,3],[43,1],[43,1],[44,1],[44,1],[44,1],[44,1],[46,3],[48,1],[48,0],[47,1],[47,1],[47,0],[41,3],[49,2],[49,2],[49,2],[49,2],[49,0],[45,1],[45,1],[51,4],[50,3],[50,2],[52,3],[52,3],[52,1]],this.inputTable={"<$>":1,"(":2,")":3,id:4,".":5,then:6,",":7,set:8,"{":9,"}":10,time:11,def:12,"=":13,hex:14,number:15,"%":16,"+":17,"-":18,str_start:19,str_end:20,str_esc_char:21,str_esc_unicode:22,str_esc_ascii:23,str_seg:24,"[":25,"]":26}}return t.parse=function(e){var a=new r.a;return a.source=e,(new t).parseLexer(a)},t.prototype.parseLexer=function(t){for(var e,a,r,s=[0],n=[];;){if(a=t.token,e=s[s.length-1],null==this.actionTable[this.inputTable[a]][e])throw new Error("Parse Error:"+t.positionInfo);if(1===(r=this.actionTable[this.inputTable[a]][e]))return n.pop();if(1==(1&r))n.push(t.yytext),s.push((r>>>1)-1),t.advance();else if(0==(1&r)){var i=r>>>1,o=this.prodList[i][1],p=null;switch(o>0&&(p=n[n.length-o]),i){case 1:p={type:"GlobalExprs",params:n[n.length-1]};break;case 2:p=n[n.length-2],p.push(n[n.length-1]);break;case 3:p=[];break;case 4:p={type:"DefExpr",params:n[n.length-1]};break;case 5:p={type:"SetExpr",params:n[n.length-1]};break;case 6:p={type:"CallExpr",params:n[n.length-1]};break;case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:break;case 17:p=n[n.length-2],p.push(n[n.length-1]);break;case 18:p=[n[n.length-1]];break;case 19:p={type:"UnitSetExpr",params:[n[n.length-5],n[n.length-3],n[n.length-1]]};break;case 20:p={type:"ThenSetExpr",params:[n[n.length-3],n[n.length-1]]};break;case 21:p={type:"GroupSetExpr",params:n[n.length-2]};break;case 22:p={type:"SetExprParams",params:[n[n.length-1]]};break;case 23:p={type:"SetExprParams",params:[n[n.length-3],n[n.length-1]]};break;case 24:p={type:"SetExprParams",params:[]};break;case 25:break;case 26:p={type:"NormalDefExpr",params:[n[n.length-5],n[n.length-4],n[n.length-2]]};break;case 27:p={type:"TweenDefExpr",params:[n[n.length-5],n[n.length-4],n[n.length-2]]};break;case 28:p=n[n.length-2],p.push(n[n.length-1]);break;case 29:p=[];break;case 30:p={type:"ASetter",params:[n[n.length-3],n[n.length-1]]};break;case 31:p={type:"SimpleValue",value:n[n.length-1]};break;case 32:break;case 33:p={type:"Num",value:n[n.length-1]};break;case 34:break;case 35:p={type:"hex",value:n[n.length-1]};break;case 36:p={type:"time",value:n[n.length-1]};break;case 37:p=[n[n.length-3],n[n.length-2],n[n.length-1]];break;case 38:case 39:case 40:case 41:break;case 42:p="+";break;case 43:p={type:"String",value:n[n.length-2]};break;case 44:p=n[n.length-2],p.push({type:"char",value:n[n.length-1]});break;case 45:p=n[n.length-2],p.push({type:"unicode",value:n[n.length-1]});break;case 46:p=n[n.length-2],p.push({type:"ascii",value:n[n.length-1]});break;case 47:p=n[n.length-2],p.push({type:"seg",value:n[n.length-1]});break;case 48:p=[];break;case 49:case 50:p={type:"ComplexValue",value:n[n.length-1]};break;case 51:p={type:"Object",params:[n[n.length-4],n[n.length-2]]};break;case 52:p={type:"Array",params:n[n.length-2]};break;case 53:p={type:"Array",params:[]};break;case 54:case 55:p=n[n.length-3],p.push(n[n.length-1]);break;case 56:p=[n[n.length-1]]}for(var u=0;u<o;)s.pop(),n.pop(),u++;if(e=s[s.length-1],null==this.gotoTable[this.prodList[i][0]][e])throw new Error("Goto Error!"+t.positionInfo);r=this.gotoTable[this.prodList[i][0]][e],s.push((r>>>1)-1),n.push(p)}}},t}();e.a=s},function(t,e,a){"use strict";var r=function(){function t(){this.transTable=[[!1,[4294967295,2,1],[[0,35,0],[36,36,1],[37,37,2]]],[!1,[4294967295,20,23,22,21,12,19,18,17,16,15,14,13,11,10,9,8,7,6,5,4,3],[[0,2,0],[3,3,1],[4,4,2],[5,5,3],[6,6,4],[7,7,5],[8,8,6],[9,9,7],[10,10,8],[11,11,9],[12,12,10],[13,13,11],[14,14,12],[15,15,13],[16,16,14],[17,17,15],[18,18,16],[19,30,17],[31,31,18],[32,32,19],[33,34,20],[35,35,21],[36,37,0]]],[!1,[26,24,25,4294967295],[[0,0,0],[1,16,1],[17,17,2],[18,32,1],[33,33,3],[34,35,1],[36,37,3]]],[!1,[4294967295,27],[[0,34,0],[35,35,1],[36,37,0]]],[!1,[4294967295,4],[[0,32,0],[33,34,1],[35,37,0]]],[!1,[4294967295,33,13,31,30,29,32,28],[[0,6,0],[7,7,1],[8,13,0],[14,14,2],[15,24,0],[25,26,3],[27,27,4],[28,29,5],[30,30,6],[31,31,7],[32,32,2],[33,37,0]]],[!1,[4294967295,34],[[0,13,0],[14,14,1],[15,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,7],[[0,6,0],[7,7,1],[8,10,0],[11,11,1],[12,12,0],[13,14,1],[15,18,0],[19,30,1],[31,31,0],[32,32,1],[33,37,0]]],[!0],[!0],[!0],[!0],[!1,[4294967295,7,35],[[0,6,0],[7,7,1],[8,10,0],[11,11,1],[12,12,0],[13,14,1],[15,18,0],[19,27,1],[28,28,2],[29,30,1],[31,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,33,13,30,29,32,28],[[0,6,0],[7,7,1],[8,13,0],[14,14,2],[15,26,0],[27,27,3],[28,29,4],[30,30,5],[31,31,6],[32,32,2],[33,37,0]]],[!1,[4294967295,7,36],[[0,6,0],[7,7,1],[8,10,0],[11,11,1],[12,12,0],[13,14,1],[15,18,0],[19,29,1],[30,30,2],[31,31,0],[32,32,1],[33,37,0]]],[!0],[!1,[4294967295,7,37],[[0,6,0],[7,7,1],[8,10,0],[11,11,1],[12,12,0],[13,14,1],[15,18,0],[19,27,1],[28,28,2],[29,30,1],[31,31,0],[32,32,1],[33,37,0]]],[!0],[!0],[!0],[!0],[!0],[!0],[!0],[!0],[!0],[!1,[38,4294967295,40,39],[[0,0,0],[1,1,1],[2,2,0],[3,12,1],[13,13,0],[14,16,1],[17,17,0],[18,21,1],[22,23,0],[24,24,2],[25,25,1],[26,26,3],[27,37,1]]],[!1,[27,41,4294967295],[[0,32,0],[33,33,1],[34,35,0],[36,37,2]]],[!1,[4294967295,34],[[0,13,0],[14,14,1],[15,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,42,43],[[0,13,0],[14,14,1],[15,15,0],[16,16,2],[17,17,0],[18,18,2],[19,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,46,44,45],[[0,6,0],[7,7,1],[8,13,0],[14,14,2],[15,30,0],[31,31,3],[32,32,2],[33,37,0]]],[!1,[4294967295,47],[[0,10,0],[11,11,1],[12,13,0],[14,14,1],[15,19,0],[20,21,1],[22,27,0],[28,29,1],[30,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,48,49],[[0,13,0],[14,14,1],[15,30,0],[31,31,2],[32,32,1],[33,37,0]]],[!1,[4294967295,50,51],[[0,13,0],[14,14,1],[15,30,0],[31,31,2],[32,32,1],[33,37,0]]],[!1,[4294967295,33,34,30,29,32],[[0,6,0],[7,7,1],[8,13,0],[14,14,2],[15,26,0],[27,27,3],[28,29,4],[30,30,5],[31,31,0],[32,32,2],[33,37,0]]],[!1,[4294967295,7,52],[[0,6,0],[7,7,1],[8,10,0],[11,11,1],[12,12,0],[13,13,2],[14,14,1],[15,18,0],[19,30,1],[31,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,7,53],[[0,6,0],[7,7,1],[8,10,0],[11,11,1],[12,12,0],[13,14,1],[15,18,0],[19,27,1],[28,28,2],[29,30,1],[31,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,7,54],[[0,6,0],[7,7,1],[8,10,0],[11,11,1],[12,12,0],[13,14,1],[15,18,0],[19,20,1],[21,21,2],[22,30,1],[31,31,0],[32,32,1],[33,37,0]]],[!0],[!1,[4294967295,55],[[0,10,0],[11,11,1],[12,13,0],[14,14,1],[15,19,0],[20,21,1],[22,27,0],[28,29,1],[30,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,56],[[0,10,0],[11,11,1],[12,13,0],[14,14,1],[15,19,0],[20,21,1],[22,27,0],[28,29,1],[30,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,41],[[0,32,0],[33,33,1],[34,37,0]]],[!1,[4294967295,33,42,30,32],[[0,6,0],[7,7,1],[8,13,0],[14,14,2],[15,26,0],[27,27,3],[28,29,0],[30,30,4],[31,31,0],[32,32,2],[33,37,0]]],[!1,[4294967295,42],[[0,13,0],[14,14,1],[15,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,33,44,58,57,45],[[0,6,0],[7,7,1],[8,13,0],[14,14,2],[15,26,0],[27,27,3],[28,29,4],[30,30,0],[31,31,5],[32,32,2],[33,37,0]]],[!1,[4294967295,59],[[0,13,0],[14,14,1],[15,31,0],[32,32,1],[33,37,0]]],[!0],[!1,[4294967295,47],[[0,10,0],[11,11,1],[12,13,0],[14,14,1],[15,19,0],[20,21,1],[22,27,0],[28,29,1],[30,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,33,48,30,60,49],[[0,6,0],[7,7,1],[8,13,0],[14,14,2],[15,26,0],[27,27,3],[28,29,4],[30,30,0],[31,31,5],[32,32,2],[33,37,0]]],[!1,[4294967295,61],[[0,13,0],[14,14,1],[15,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,50,58,62,51],[[0,13,0],[14,14,1],[15,26,0],[27,27,2],[28,29,3],[30,30,0],[31,31,4],[32,32,1],[33,37,0]]],[!1,[4294967295,63],[[0,13,0],[14,14,1],[15,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,7],[[0,6,0],[7,7,1],[8,10,0],[11,11,1],[12,12,0],[13,14,1],[15,18,0],[19,30,1],[31,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,7,64],[[0,6,0],[7,7,1],[8,10,0],[11,11,1],[12,12,0],[13,14,1],[15,18,0],[19,22,1],[23,23,2],[24,30,1],[31,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,7],[[0,6,0],[7,7,1],[8,10,0],[11,11,1],[12,12,0],[13,14,1],[15,18,0],[19,30,1],[31,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,65],[[0,10,0],[11,11,1],[12,13,0],[14,14,1],[15,19,0],[20,21,1],[22,27,0],[28,29,1],[30,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,66],[[0,10,0],[11,11,1],[12,13,0],[14,14,1],[15,19,0],[20,21,1],[22,27,0],[28,29,1],[30,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,67,68],[[0,13,0],[14,14,1],[15,15,0],[16,16,2],[17,17,0],[18,18,2],[19,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,46],[[0,6,0],[7,7,1],[8,37,0]]],[!1,[4294967295,33,59,58,57],[[0,6,0],[7,7,1],[8,13,0],[14,14,2],[15,26,0],[27,27,3],[28,29,4],[30,31,0],[32,32,2],[33,37,0]]],[!1,[4294967295,69,70],[[0,13,0],[14,14,1],[15,15,0],[16,16,2],[17,17,0],[18,18,2],[19,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,33,61,30,60],[[0,6,0],[7,7,1],[8,13,0],[14,14,2],[15,26,0],[27,27,3],[28,29,4],[30,31,0],[32,32,2],[33,37,0]]],[!1,[4294967295,71,72],[[0,13,0],[14,14,1],[15,15,0],[16,16,2],[17,17,0],[18,18,2],[19,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,63,58,62],[[0,13,0],[14,14,1],[15,26,0],[27,27,2],[28,29,3],[30,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,7],[[0,6,0],[7,7,1],[8,10,0],[11,11,1],[12,12,0],[13,14,1],[15,18,0],[19,30,1],[31,31,0],[32,32,1],[33,37,0]]],[!0],[!1,[4294967295,73],[[0,10,0],[11,11,1],[12,13,0],[14,14,1],[15,19,0],[20,21,1],[22,27,0],[28,29,1],[30,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,33,67,58],[[0,6,0],[7,7,1],[8,13,0],[14,14,2],[15,26,0],[27,27,3],[28,31,0],[32,32,2],[33,37,0]]],[!1,[4294967295,67],[[0,13,0],[14,14,1],[15,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,33,69,30],[[0,6,0],[7,7,1],[8,13,0],[14,14,2],[15,26,0],[27,27,3],[28,31,0],[32,32,2],[33,37,0]]],[!1,[4294967295,69],[[0,13,0],[14,14,1],[15,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,71,58],[[0,13,0],[14,14,1],[15,26,0],[27,27,2],[28,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,71],[[0,13,0],[14,14,1],[15,31,0],[32,32,1],[33,37,0]]],[!1,[4294967295,74],[[0,10,0],[11,11,1],[12,13,0],[14,14,1],[15,19,0],[20,21,1],[22,27,0],[28,29,1],[30,31,0],[32,32,1],[33,37,0]]],[!0]],this.finalTable={64:15,65:10,4:1,5:3,6:23,7:26,8:5,9:7,10:6,11:24,12:26,13:3,14:26,15:21,16:26,17:16,18:19,19:20,20:25,21:17,22:18,23:22,24:12,25:11,74:9,30:2,32:2,33:2,34:3,35:26,36:26,37:26,38:8,41:0,42:3,27:0,46:2,47:4,52:13,53:26,54:14},this.inputTable=[[0,8,1],[9,9,34],[10,10,33],[11,11,1],[12,12,34],[13,13,33],[14,31,1],[32,32,34],[33,33,1],[34,34,17],[35,35,1],[36,36,19],[37,37,3],[38,38,1],[39,39,2],[40,40,6],[41,41,5],[42,42,1],[43,43,18],[44,44,15],[45,45,16],[46,46,31],[47,47,35],[48,48,32],[49,57,14],[58,60,1],[61,61,10],[62,63,1],[64,64,19],[65,68,20],[69,69,29],[70,70,20],[71,87,19],[88,88,25],[89,90,19],[91,91,9],[92,92,0],[93,93,8],[94,94,1],[95,95,19],[96,96,1],[97,99,20],[100,100,11],[101,101,28],[102,102,21],[103,103,19],[104,104,30],[105,108,19],[109,109,27],[110,110,23],[111,113,19],[114,114,22],[115,115,7],[116,116,13],[117,117,24],[118,119,19],[120,120,26],[121,122,19],[123,123,12],[124,124,1],[125,125,4],[126,65535,1]],this.initialTable={INITIAL:2,STRING:1}}return t.lexSeq=function(e){var a=new t;a.source=e;for(var r=[],s=a.token;"<$>"!==s;)r.push({token:s,text:a.yytext,start:a.startIdx,end:a.endIdx}),a.advance(),s=a.token;return r},t.prototype.yyrestart=function(t){void 0===t&&(t=null),null!=t&&(this.sourceString=t),this.ended=!1,this.start=0,this.oldStart=0,this.line=1,this.col=0,this.advanced=!0,this.tokenNameString=null,this.yyObject={},this.initialState="INITIAL"},Object.defineProperty(t.prototype,"source",{set:function(t){this.sourceString=t,this.yyrestart()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"token",{get:function(){return this.advanced&&(this.tokenNameString=this.next(),this.advanced=!1),this.tokenNameString},enumerable:!0,configurable:!0}),t.prototype.advance=function(){this.advanced=!0},Object.defineProperty(t.prototype,"startIdx",{get:function(){return this.oldStart},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endIdx",{get:function(){return this.start},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return[this.line,this.col]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positionInfo",{get:function(){return this.token+"@row:"+this.position.join("col:")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yytext",{get:function(){return this.yyText},set:function(t){this.yyText=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yyleng",{get:function(){return this.endIdx-this.startIdx},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yy",{get:function(){return this.yyObject},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tokenName",{get:function(){return this.tokenNameString},enumerable:!0,configurable:!0}),t.prototype.next=function(){for(var t,e,a,r,s,n,i,o,p;;)for(t=null,e=null,a=0,r=this.start,s=this.start,n=4294967295,o=4294967295,p=this.start,i=this.transTable[0][1][this.initialInput];;){if(a=this.sourceString.charCodeAt(s),4294967295!==n&&(13===a?(this.col=0,this.line++):10===a?13!==n&&(this.col=0,this.line++):this.col++),n=a,4294967295===(e=this.trans(i,a))){if(r===p){if(this.start===this.sourceString.length){if(!1===this.ended)return this.ended=!0,"<$>";throw new Error("\u5df2\u7ecf\u5230\u8fbe\u672b\u5c3e.")}throw new Error("\u610f\u5916\u7684\u5b57\u7b26,line:"+this.position.join(",col:")+"of "+this.sourceString.substr(r,20))}switch(t=this.finalTable[o],this.start=p,this.oldStart=r,this.yyText=this.sourceString.substring(this.startIdx,this.endIdx),t){case 2:return"time";case 3:return"number";case 4:return"hex";case 5:return"+";case 6:return"-";case 7:return this.begin("STRING"),"str_start";case 8:return"str_esc_char";case 9:return"str_esc_unicode";case 10:return"str_esc_ascii";case 11:return this.begin("INITIAL"),"str_end";case 12:return"str_seg";case 13:return"set";case 14:return"def";case 15:return"then";case 16:return"=";case 17:return"(";case 18:return")";case 19:return"[";case 20:return"]";case 21:return"{";case 22:return"}";case 23:return".";case 24:return",";case 25:return"%";case 26:return"id"}break}t=this.finalTable[e],null!=t&&(o=e,p=s+1),s+=1,i=e}},t.prototype.trans=function(t,e){if(isNaN(e))return 4294967295;if(e<this.inputTable[0][0]||e>this.inputTable[this.inputTable.length-1][1])throw new Error("\u8f93\u5165\u8d85\u51fa\u6709\u6548\u8303\u56f4,line:"+this.position.join(",col:"));if(!0===this.transTable[t][0])return 4294967295;var a=this.find(e,this.inputTable),r=this.find(a,this.transTable[t][2]);return this.transTable[t][1][r]},t.prototype.find=function(t,e){var a,r,s;for(a=0,r=e.length-1;;){if(s=a+r>>>1,e[s][0]<=t&&e[s][1]>=t)return e[s][2];e[s][0]>t?r=s-1:a=s+1}},t.prototype.begin=function(t){if(void 0===t&&(t=null),null==t)return void(this.initialState="INITIAL");this.initialState=t},Object.defineProperty(t.prototype,"initialState",{get:function(){return this.initialStateString},set:function(t){if(void 0===this.initialTable[t])throw new Error("\u672a\u5b9a\u4e49\u7684\u8d77\u59cb\u72b6\u6001:"+t);this.initialStateString=t,this.initialInput=this.initialTable[t]},enumerable:!0,configurable:!0}),t}();e.a=r},function(t,e,a){"use strict";var r=a(0),s=function(){function t(t){this.ast=t,this.defTypeInfo={}}return t.prototype.transform=function(){for(var t=this.ast,e=[],a=[],r=0,s=t.params;r<s.length;r++){var n=s[r];switch(n.type){case"SetExpr":e.push(this.trans(n.params));break;case"DefExpr":var i=n.params;switch(i.type){case"NormalDefExpr":var o=i.params[0],p=i.params[1];switch(o){case"text":case"button":case"path":this.defTypeInfo[p]=o}a.push(i)}}}return a=a.map(this.transDef.bind(this)).filter(function(t){return null!=t}),e=e.map(this.transSet.bind(this)).filter(function(t){return null!=t}),{sets:e,defs:a}},t.prototype.trans=function(t){if("ThenSetExpr"===t.type){var e=this.trans(t.params[0]),a=this.trans(t.params[1]);return"ThenSetExpr"===e.type?(e.params.push(a),e):(t.params=[e,a],t)}return"GroupSetExpr"===t.type?(t.params=t.params.map(this.trans.bind(this)).filter(function(t){return null!=t}),t):"UnitSetExpr"===t.type?t:void 0},t.prototype.transDef=function(t){if("NormalDefExpr"===t.type&&3===t.params.length){var e=t.params[0],a=t.params[1],r=t.params[2];if("text"===e){for(var s={type:"DefText",name:a,attrs:{}},n=0,i=r;n<i.length;n++){var o=i[n];this.transAsetterNV(o,s)}return s}if("button"===e){for(var s={type:"DefButton",name:a,attrs:{}},p=0,u=r;p<u.length;p++){var o=u[p];this.transAsetterNV(o,s)}return s}if("path"===e){for(var s={type:"DefPath",name:a,attrs:{}},l=0,h=r;l<h.length;l++){var o=h[l];this.transAsetterNV(o,s)}return s}}},t.prototype.transAsetterNV=function(t,e){if("DefText"===e.type){var a=t.params[0];t.params[1];switch(a){case"content":e.attrs.content=this.parseString(t.params[1]);break;case"fontFamily":e.attrs.fontFamily=this.parseString(t.params[1]);break;case"fontSize":e.attrs.fontSize=this.parseNum(t.params[1]);break;case"x":e.attrs.x=this.parseNum(t.params[1]);break;case"y":e.attrs.y=this.parseNum(t.params[1]);break;case"alpha":e.attrs.alpha=this.parseNum(t.params[1]);break;case"anchorX":e.attrs.anchorX=this.parseNum(t.params[1]);break;case"anchorY":e.attrs.anchorY=this.parseNum(t.params[1]);break;case"color":e.attrs.color=this.parseInteger(t.params[1]);break;case"zIndex":e.attrs.zIndex=this.parseInteger(t.params[1]);break;case"parent":e.attrs.parent=this.parseString(t.params[1]);break;case"bold":e.attrs.bold=this.parseInteger(t.params[1]);break;case"textShadow":e.attrs.textShadow=this.parseInteger(t.params[1]);break;case"strokeWidth":e.attrs.strokeWidth=this.parseInteger(t.params[1]);break;case"strokeColor":e.attrs.strokeColor=this.parseInteger(t.params[1]);break;case"rotateX":e.attrs.rotateX=this.parseNum(t.params[1]);break;case"rotateY":e.attrs.rotateY=this.parseNum(t.params[1]);break;case"rotateZ":e.attrs.rotateZ=this.parseNum(t.params[1]);break;case"scale":e.attrs.scale=this.parseNum(t.params[1]);break;case"duration":e.attrs.duration=this.parseTime(t.params[1])}}else if("DefButton"===e.type){var a=t.params[0];t.params[1];switch(a){case"text":e.attrs.text=this.parseString(t.params[1]);break;case"fontSize":e.attrs.fontSize=this.parseNum(t.params[1]);break;case"textColor":e.attrs.textColor=this.parseInteger(t.params[1]);break;case"textAlpha":e.attrs.textAlpha=this.parseNum(t.params[1]);break;case"fillColor":e.attrs.fillColor=this.parseInteger(t.params[1]);break;case"fillAlpha":e.attrs.fillAlpha=this.parseNum(t.params[1]);break;case"x":e.attrs.x=this.parseNum(t.params[1]);break;case"y":e.attrs.y=this.parseNum(t.params[1]);break;case"duration":e.attrs.duration=this.parseTime(t.params[1]);break;case"target":e.attrs.target=this.parseObject(t.params[1]);break;case"zIndex":e.attrs.zIndex=this.parseInteger(t.params[1]);break;case"scale":e.attrs.scale=this.parseNum(t.params[1])}}else if("DefPath"===e.type){var a=t.params[0];t.params[1];switch(a){case"d":e.attrs.d=this.parseString(t.params[1],!0);break;case"viewBox":e.attrs.viewBox=this.parseString(t.params[1],!0);break;case"fillColor":e.attrs.fillColor=this.parseInteger(t.params[1]);break;case"fillAlpha":e.attrs.fillAlpha=this.parseNum(t.params[1]);break;case"borderColor":e.attrs.borderColor=this.parseInteger(t.params[1]);break;case"borderAlpha":e.attrs.borderAlpha=this.parseNum(t.params[1]);break;case"borderWidth":e.attrs.borderWidth=this.parseNum(t.params[1]);break;case"x":e.attrs.x=this.parseNum(t.params[1]);break;case"y":e.attrs.y=this.parseNum(t.params[1]);break;case"scale":e.attrs.scale=this.parseNum(t.params[1]);break;case"width":e.attrs.width=this.parseNum(t.params[1]);break;case"height":e.attrs.height=this.parseNum(t.params[1]);break;case"duration":e.attrs.duration=this.parseTime(t.params[1]);break;case"zIndex":e.attrs.zIndex=this.parseInteger(t.params[1])}}},t.prototype.parseString=function(t,e){if(void 0===e&&(e=!1),"SimpleValue"===t.type)return this.parseString2(t.value,e)},t.prototype.parseString2=function(t,e){if(void 0===e&&(e=!1),"String"===t.type){for(var a=[],s=0,n=t.value;s<n.length;s++){var i=n[s];switch(i.type){case"char":var o=null;switch(i.value.charAt(1)){case"n":o="\n";break;case"r":o="\r";break;case"t":o="\t";break;case"\\":o="\\";break;case"'":o="'";break;case'"':o='"';break;default:o=i.charAt(1)}a.push(o);break;case"unicode":case"ascii":var p=i.value.substr(2);a.push(String.fromCharCode(parseInt(p,16)));break;case"seg":a.push(i.value)}}return r.a.htmlEncode(a.join(""),e)}},t.prototype.parseNum=function(t){if("SimpleValue"===t.type)return this.parseNum2(t.value)},t.prototype.parseNum2=function(t){if("Num"===t.type){var e="+"===t.value[0]?1:-1,a=t.value[1];return{numType:"%"===t.value[2]?"percent":"number",value:e*parseFloat(a)}}},t.prototype.parseInteger=function(t){if("SimpleValue"===t.type)return this.parseInteger2(t.value)},t.prototype.parseInteger2=function(t){return"hex"===t.type?parseInt(t.value.substr(2),16):"Num"===t.type?Math.floor(this.parseNum2(t).value):void 0},t.prototype.transSet=function(t){if("ThenSetExpr"===t.type||"GroupSetExpr"===t.type){var e=t.params.map(this.transSet.bind(this)).filter(function(t){return null!=t});if(e.length>0)return{type:"ThenSetExpr"===t.type?"Serial":"Parallel",items:e}}else if("UnitSetExpr"===t.type){var a=t.params[0],r=this.defTypeInfo[a],s=this.parseSetExprParams(t.params[2]),n=s[0],i=s[1];if("text"===r||"button"===r||"path"===r){for(var o={type:"Unit",duration:n,defaultEasing:i,targetName:a,attrs:{}},p=0,u=t.params[1];p<u.length;p++){var l=u[p];this.transAsetter(r,l,o.attrs)}return o}return null}},t.prototype.parseSetExprParams=function(t){var e=0,a=null;return"SetExprParams"===t.type&&(t.params.length>=1&&(e=this.parseTime2(t.params[0])),t.params.length>=2&&(a=this.parseString2(t.params[1]))),[e,a]},t.prototype.parseTime=function(t){if("SimpleValue"===t.type&&"time"===t.value.type)return this.parseTime2(t.value.value)},t.prototype.parseTime2=function(t){for(var e=!0,a=0,r=0,s="",n=null;;){if(null==(n=e?t.match(/^(\d*\.?\d+(?:[eE][\+\-]?\d+)?)(.*)$/):t.match(/^([hms]+)(.*)$/)))return a;if(s=n[1],e)r=parseFloat(s);else switch(s){case"h":a+=3600*r*1e3;break;case"m":a+=60*r*1e3;break;case"s":a+=1e3*r;break;case"ms":a+=r}t=n[2],e=!e}},t.prototype.parseObject=function(t){if("ComplexValue"===t.type&&"Object"===t.value.type)return this.parseObject2(t.value)},t.prototype.parseObject2=function(t){var e=t.params[0],a=t.params[1],r={};switch(e){case"seek":r.objType="seek";for(var s=0,n=a;s<n.length;s++){var i=n[s];if("ASetter"===i.type){var o=i.params[0],p=i.params[1];switch(o){case"time":r.time=this.parseTime(p)}}}break;case"av":r.objType="av";for(var u=0,l=a;u<l.length;u++){var i=l[u];if("ASetter"===i.type){var o=i.params[0],p=i.params[1];switch(o){case"av":r.av=this.parseInteger(p);break;case"page":r.page=this.parseInteger(p);break;case"time":r.time=this.parseTime(p)}}}break;case"bangumi":r.objType="bangumi";for(var h=0,c=a;h<c.length;h++){var i=c[h];if("ASetter"===i.type){var o=i.params[0],p=i.params[1];switch(o){case"seasonId":r.seasonId=this.parseInteger(p);break;case"episodeId":r.episodeId=this.parseInteger(p);break;case"time":r.time=this.parseTime(p)}}}}return r},t.prototype.transAsetter=function(t,e,a){if("ASetter"===e.type&&2===e.params.length){var r=e.params[0],s=this.transAsetterValue(e.params[1]),n=s[0],i=s[1];if("text"===t)switch(r){case"x":case"y":case"alpha":case"color":case"fontSize":case"content":case"rotateX":case"rotateY":case"rotateZ":case"scale":a[r]={value:n,easing:i}}else if("button"===t)switch(r){case"x":case"y":case"fontSize":case"text":a[r]={value:n,easing:i}}else if("path"===t)switch(r){case"x":case"y":a[r]={value:n,easing:i}}}},t.prototype.transAsetterValue=function(t){if("SimpleValue"===t.type){var e=this.transValue(t.value);return[e,null]}if("ComplexValue"===t.type&&"Array"===t.value.type&&2===t.value.params.length){var e=this.transValue(t.value.params[0]);return[e,this.parseString2(t.value.params[1])]}return[null,null]},t.prototype.transValue=function(t){switch(t.type){case"String":return this.parseString2(t);case"Num":return this.parseNum2(t);case"hex":return this.parseInteger2(t)}},t}();e.a=s}]).default});