!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("BasDanmaku",[],t):"object"==typeof exports?exports.BasDanmaku=t():e.BasDanmaku=t()}(window,function(){return function(r){var a={};function n(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}return n.m=r,n.c=a,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t,r){e.exports=function(){return r(6)(
'!function(r){var a={};function n(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}n.m=r,n.c=a,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,r){"use strict";r.r(t);var b=function(e,t){var r={};for(var a in e)e.hasOwnProperty(a)&&(r[a]=e[a]);for(var a in t)t.hasOwnProperty(a)&&(r[a]=t[a]);return r},f=function(e,t,r){return r||(e=e.replace(/&/g,"").replace(/</g,"").replace(/>/g,"").replace(/"/g,"").replace(/\'/g,"").replace(/\\//g,"").replace(/:/g,"").replace(/;/g,"")),e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/\'/g,"&#x27;").replace(/\\//g,"&#x2f;").replace(/ /g,t?" ":"&nbsp;").replace(/\\n/g,"<br>")},a=function(){function e(){this.class_names=["text","button","path"],this._variable_table={},this._varibale_reg_order=0,this._template_table={},this.tpl_name_id=0,this.obj_name_id=0,this._allows_variable=[]}return e.prototype.on_String_value=function(e){for(var t=[],r=0,a=e;r<a.length;r++){var n=a[r];switch(n.type){case"char":var s=null;switch(n.value.charAt(1)){case"n":s="\\n";break;case"r":s="\\r";break;case"t":s="\\t";break;case"\\\\":s="\\\\";break;case"\'":s="\'";break;case\'"\':s=\'"\';break;default:s=n.charAt(1)}t.push(s);break;case"unicode":case"ascii":var i=n.value.substr(2);t.push(String.fromCharCode(parseInt(i,16)));break;case"seg":t.push(n.value)}}return new o({type:"String",value:t.join("")})},e.prototype.on_Num_value=function(e,t,r){return t=t,new o({type:"Num",value:{numType:(r="%"==r)?"percent":"number",value:(e="+"==e?1:-1)*parseFloat(t)}})},e.prototype.on_Time_value=function(e){for(var t=!0,r=0,a=0,n="",s=null;null!=(s=t?e.match(/^(\\d*\\.?\\d+(?:[eE][\\+\\-]?\\d+)?)(.*)$/):e.match(/^([hms]+)(.*)$/));){if(n=s[1],t)a=parseFloat(n);else switch(n){case"h":r+=3600*a*1e3;break;case"m":r+=60*a*1e3;break;case"s":r+=1e3*a;break;case"ms":r+=a}e=s[2],t=!t}return new o({type:"Time",value:r})},e.prototype.on_Hex_value=function(e){return new o({type:"Hex",value:parseInt(e.substr(2),16)})},e.prototype.on_Object_value=function(e,t){return new o({type:"Object",value:t})},e.prototype.on_Array_value=function(e){return new o({type:"Array",value:e})},e.prototype.on_Variable_value=function(e){return new o({type:"Variable",value:e})},e.prototype.on_KeyValue_list=function(e,t,r){return void 0===r&&(r=null),null==r&&(r=this.peek_allows_varable()),t},e.prototype.on_let_object_binding=function(e,t){t.obj_type;var r=t.name;return this.unregister_variable(r),t.name=e,this.register_variable(e,t),t},e.prototype.on_def_object=function(e,t,r){var a={type:"Def"+this.capitalization_str(e),obj_type:e,name:t,attrs:{}},n=this.on_KeyValue_list(e,r,!1);return this.fill_kv_obj(a.attrs,n),this.register_variable(t,a),a},e.prototype.on_def_template=function(e,t,r,a){var n={type:"template",obj_type:e,name:t,attrs:{},tpl_list:[]},s=this.on_KeyValue_list(e,a,!0);return this.check_variables_on_template_body(r,s),this.fill_kv_obj(n.attrs,a),n.tpl_list=r,this.register_template(t,n),n},e.prototype.on_object_modification=function(e,t){if(!this.has_variable_obj(e)){if(-1==this.class_names.indexOf(e))return null;var r=this.new_variable_name_of_template_application(e);return this.on_def_object(e,r,t)}var a=this.get_variable_obj(e),n=a.obj_type,s=this.new_variable_name_of_variable_modification(e),i={type:"Def"+this.capitalization_str(n),obj_type:n,name:s,attrs:{}\n},o=this.on_KeyValue_list(n,t,!1),l=this.merge_list(a.attrs,o);return this.fill_kv_obj(i.attrs,l),this.register_variable(s,i),i},e.prototype.on_tmp_object_modification=function(e,t){var r=e.name,a=this.on_object_modification(r,t);return this.unregister_variable(r),a},e.prototype.on_template_application=function(e,t){var r=this.get_template_obj(e);if(null==r)return null;var a=r.obj_type,n=this.new_variable_name_of_template_application(e),s={type:"Def"+this.capitalization_str(a),obj_type:a,name:n,attrs:{}},i=this.evaluation_template(r.attrs,r.tpl_list,t);return this.fill_kv_obj(s.attrs,i),this.register_variable(n,s),s},e.prototype.on_ArgList=function(e){for(var t=[],r=[],a=0,n=e;a<n.length;a++){var s=n[a],i=s[0],o=s[1];null==i?t.push(o):r.push([i,o])}return{naked_params:t,named_params:r}},e.prototype.on_unit_set_expr=function(e,t,r){var a={type:"Unit",duration:r[0],default_easing:r[1],target_name:e,attrs:{}},n=this.get_variable_type(e),s=this.on_KeyValue_list(n,t,!1);return this.fill_kv_obj(a.attrs,s),a},e.prototype.on_temporary_target_set_expr=function(e,t,r){var a=e.obj_type,n=e.name,s={type:"Unit",duration:r[0],default_easing:r[1],target_name:n,attrs:{}},i=this.on_KeyValue_list(a,t,!1);return this.fill_kv_obj(s.attrs,i),s},e.prototype.on_then_set_expr=function(e,t){return"Serial"==e.type?(e.items.push(t),e):{type:"Serial",items:[e,t]}},e.prototype.on_group_set_expr=function(e){return{type:"Parallel",items:e}},e.prototype.has_variable_obj=function(e){return this._variable_table.hasOwnProperty(e)},e.prototype.get_variable_obj=function(e){return this._variable_table.hasOwnProperty(e)?this._variable_table[e]:(console.error("var "+e+" is not defined."),null)},e.prototype.get_template_obj=function(e){return this._template_table.hasOwnProperty(e)?this._template_table[e]:(console.error("tpl "+e+" is not defined."),null)},e.prototype.get_variable_type=function(e){return this.get_variable_obj(e).obj_type},e.prototype.get_template_type=function(e){return this.get_template_obj(e).obj_type},e.prototype.fill_kv_obj=function(e,t){for(var r=0,a=t;r<a.length;r++){var n=a[r],s=n[0],i=n[1];e[s]=i}},e.prototype.merge_list=function(e,t){var r={};this.fill_kv_obj(r,t);var a=[];for(var n in e)r.hasOwnProperty(n)?a.push([n,r[n]]):a.push([n,e[n]]);for(var s=0,i=t;s<i.length;s++){var o=i[s],l=(n=o[0],o[1]);e.hasOwnProperty(n)||a.push([n,l])}return a},e.prototype.evaluation_template=function(e,t,r){for(var a=r.naked_params,n=r.named_params,s={},i=t.map(function(e,t){var r=e[0];e[1];return s[r]=t,{key:r,matched:!1}}),o={},l=0,u=n;l<u.length;l++){var p=u[l],h=p[0],c=p[1];o[h]=c,s.hasOwnProperty(h)?i[s[h]].matched=!0:console.error("看看命名参数是不是没有在定义参数里面..")}var _=i.filter(function(e){return!e.matched});_.length<a.length&&console.error("参数太多了..");for(var b=0;b<a.length&&b<_.length;b++){o[h=_[b].key]=a[b]}for(var f={},v=0,g=t;v<g.length;v++){var y=g[v];h=y[0],c=y[1];o.hasOwnProperty(h)?f[h]=o[h]:f[h]=c}var d=[];for(var h in e){var m=e[h];if("Variable"==m.type){var k=m.value;f.hasOwnProperty(k)?d.push([h,f[k]]):console.error("eval template err: no variable named "+k+" is provided.")}else d.push([h,m])}return d},e.prototype.capitalization_str=function(e){return e.substr(0,1).toUpperCase()+e.substr(1)},e.prototype.new_variable_name_of_template_application=function(e){var t="tpl_"+e+"_"+this.tpl_name_id;return this.tpl_name_id+=1,t},e.prototype.new_variable_name_of_variable_modification=function(e){var t="obj_"+e+"_"+this.obj_name_id;return this.obj_name_id+=1,t},e.prototype.register_variable=function(e,t){this._variable_table.hasOwnProperty(e)&&console.log("var "+e+" is already exists, and will be shadowed."),t._reg_order=this._varibale_reg_order,this._variable_table[e]=t,this._varibale_reg_order+=1},e.prototype.unregister_variable=function(e){delete this._variable_table[e]},e.prototype.register_template=function(e,t){this._template_table.hasOwnProperty(e)&&console.log("tpl "+e+" is already exists, and will be shadowed."),this._template_table[e]=t},e.prototype.on_enter_scope=function(){},e.prototype.on_leave_scope=function(){},\ne.prototype.on_enter_tpl=function(){this._allows_variable.push(!0)},e.prototype.on_leave_tpl=function(){this._allows_variable.pop()},e.prototype.peek_allows_varable=function(){return 0<this._allows_variable.length&&this._allows_variable[this._allows_variable.length-1]},e.prototype.check_variables_on_template_body=function(e,t){var r={};this.fill_kv_obj(r,t);for(var a=0,n=e;a<n.length;a++){var s=n[a],i=(s[0],s[1]);if("Variable"==i.type){var o=i.value;r.hasOwnProperty(o)||console.error("varibale "+o+" in template\'s body is not present at arguments.")}}},e.prototype.on_Result=function(e){var t=[];for(var r in this._variable_table)t.push(this._variable_table[r]);return t.sort(function(e,t){return e.obj_name_id-t.obj_name_id}),{sets:e.filter(function(e){return"SetExpr"==e.type}).map(function(e){return e.params}),defs:t}},e}(),o=function(){function e(e){this.type=e.type,this.value=e.value}return e.prototype.as_string=function(){if("String"==this.type)return this.value},e.prototype.as_integer=function(){return"Hex"==this.type?this.value:"Num"==this.type?Math.floor(this.value.value):void 0},e.prototype.as_number=function(){if("Num"==this.type)return this.value},e.prototype.as_time=function(){if("Time"==this.type)return this.value},e.prototype.as_object=function(){if("Object"==this.type)return this.value},e}(),u=4294967295,p=4294967295,n=function(){function n(){this.transTable=[[!1,[4294967295,2,1],[[0,42,0],[43,43,1],[44,44,2]]],[!1,[4294967295,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3],[[0,2,0],[3,3,1],[4,4,2],[5,5,3],[6,6,4],[7,7,5],[8,8,6],[9,9,7],[10,10,8],[11,11,9],[12,12,10],[13,13,11],[14,14,12],[15,15,13],[16,16,14],[17,17,15],[18,18,16],[19,19,17],[20,20,18],[21,21,19],[22,22,20],[23,37,21],[38,38,22],[39,39,23],[40,41,24],[42,42,25],[43,44,0]]],[!1,[30,28,29,4294967295],[[0,0,0],[1,20,1],[21,21,2],[22,39,1],[40,40,3],[41,42,1],[43,44,3]]],[!1,[4294967295,31],[[0,41,0],[42,42,1],[43,44,0]]],[!1,[4294967295,4],[[0,39,0],[40,41,1],[42,44,0]]],[!1,[4294967295,14,37,36,35,34,33,32],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,31,0],[32,32,3],[33,34,4],[35,35,5],[36,37,6],[38,38,7],[39,39,1],[40,44,0]]],[!1,[4294967295,38],[[0,15,0],[16,16,1],[17,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!0],[!0],[!0],[!0],[!1,[4294967295,7,39],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,35,1],[36,36,2],[37,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,40],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,35,1],[36,36,2],[37,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,14,37,36,34,33,32],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,31,0],[32,32,3],[33,34,0],[35,35,4],[36,37,5],[38,38,6],[39,39,1],[40,44,0]]],[!1,[4294967295,7,41],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,31,1],[32,32,2],[33,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,42],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,35,1],[36,36,2],[37,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!0],[!0],[!0],[!0],[!0],[!1,[4294967295,7,43],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,30,1],[31,31,2],[32,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,44],[[0,6,0],[7,8,1],[9,13,0],[14,16,1],[17,17,2],[18,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!0],[!0],[!0],[!0],[!0],[!0],[!1,[45,4294967295,47,46],[[0,0,0],[1,1,1],[2,2,0],[3,14,1],[15,15,0],[16,20,1],[21,21,0],[22,27,1],[28,28,2],[29,30,0],[31,33,1],[34,34,3],[35,44,1]]],[!1,[31,48,4294967295],[[0,39,0],[40,40,1],[41,42,0],[43,44,2]]],[!1,[4294967295,38],[[0,15,0],[16,16,1],[17,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,49,50],[[0,15,0],[16,16,1],[17,19,0],[20,20,2],[21,21,0],[22,22,2],[23,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,51,53,52],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,37,0],[38,38,3],[39,39,1],[40,44,0]]],[!1,[4294967295,54],[[0,6,0],[7,8,1],[9,13,0],[14,14,1],[15,15,0],[16,16,1],[17,25,0],[26,27,1],[28,35,0],[36,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,55,56],[[0,15,0],[16,16,1],[17,37,0],[38,38,2],[39,39,1],[40,44,0]]\n],[!1,[4294967295,57,58],[[0,15,0],[16,16,1],[17,37,0],[38,38,2],[39,39,1],[40,44,0]]],[!1,[4294967295,38,37,36,34,33],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,31,0],[32,32,3],[33,34,0],[35,35,4],[36,37,5],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,59],[[0,6,0],[7,8,1],[9,13,0],[14,14,1],[15,15,2],[16,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,60],[[0,6,0],[7,8,1],[9,13,0],[14,14,1],[15,15,2],[16,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,61],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,35,1],[36,36,2],[37,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,62],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,26,1],[27,27,2],[28,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,63],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,30,1],[31,31,2],[32,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,64],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,24,1],[25,25,2],[26,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!0],[!1,[4294967295,65],[[0,6,0],[7,8,1],[9,13,0],[14,14,1],[15,15,0],[16,16,1],[17,25,0],[26,27,1],[28,35,0],[36,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,66],[[0,6,0],[7,8,1],[9,13,0],[14,14,1],[15,15,0],[16,16,1],[17,25,0],[26,27,1],[28,35,0],[36,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,48],[[0,39,0],[40,40,1],[41,44,0]]],[!1,[4294967295,49,37,36,34],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,31,0],[32,32,3],[33,34,0],[35,35,4],[36,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,49],[[0,15,0],[16,16,1],[17,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,51,37,68,67,52],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,34,0],[35,35,3],[36,37,4],[38,38,5],[39,39,1],[40,44,0]]],[!1,[4294967295,69],[[0,15,0],[16,16,1],[17,38,0],[39,39,1],[40,44,0]]],[!0],[!1,[4294967295,54],[[0,6,0],[7,8,1],[9,13,0],[14,14,1],[15,15,0],[16,16,1],[17,25,0],[26,27,1],[28,35,0],[36,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,55,37,34,70,56],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,34,0],[35,35,3],[36,37,4],[38,38,5],[39,39,1],[40,44,0]]],[!1,[4294967295,71],[[0,15,0],[16,16,1],[17,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,57,68,72,58],[[0,15,0],[16,16,1],[17,34,0],[35,35,2],[36,37,3],[38,38,4],[39,39,1],[40,44,0]]],[!1,[4294967295,73],[[0,15,0],[16,16,1],[17,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,74],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,29,1],[30,30,2],[31,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,75],[[0,6,0],[7,8,1],[9,13,0],[14,16,1],[17,17,2],[18,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,76],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,29,1],[30,30,2],[31,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,77],[[0,6,0],[7,8,1],[9,13,0],[14,14,1],[15,15,0],[16,16,1],[17,25,0],[26,27,1],[28,35,0],[36,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,78],[[0,6,0],[7,8,1],[9,13,0],[14,14,1],[15,15,0],[16,16,1],[17,25,0],[26,27,1],[28,35,0],[36,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,79,80],[[0,15,0],[16,16,1],[17,19,0],[20,20,2],[21,21,0],[22,22,2],[23,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,53],[[0,17,0],[18,18,1],[19,44,0]]],[!1,[4294967295,69,37,68,67],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,34,0],[35,35,3],[36,37,4],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,81,82],[[0,15,0],[16,16,1],[17,19,0],[20,20,2],[21,21,0],[22,22,2],[23,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,71,37,34,70],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,34,0],[35,35,3],[36,37,4],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,83,84],[[0,15,0],[16,16,1],[17,19,0],[20,20,2],[21,21,0],[22,22,2],[23,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,73,68,72],[[0,15,0],[16,16,1],[17,34,0],[35,35,2],[36,37,3],[38,38,0],[39,39,1]\n,[40,44,0]]],[!1,[4294967295,7],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,85],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,23,1],[24,24,2],[25,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,86],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,35,1],[36,36,2],[37,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!0],[!1,[4294967295,87],[[0,6,0],[7,8,1],[9,13,0],[14,14,1],[15,15,0],[16,16,1],[17,25,0],[26,27,1],[28,35,0],[36,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,79,37,68],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,34,0],[35,35,3],[36,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,79],[[0,15,0],[16,16,1],[17,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,81,37,34],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,34,0],[35,35,3],[36,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,81],[[0,15,0],[16,16,1],[17,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,83,68],[[0,15,0],[16,16,1],[17,34,0],[35,35,2],[36,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,83],[[0,15,0],[16,16,1],[17,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,88],[[0,6,0],[7,8,1],[9,13,0],[14,14,1],[15,15,0],[16,16,1],[17,25,0],[26,27,1],[28,35,0],[36,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!0]],this.finalTable={4:1,5:3,6:26,7:30,8:5,9:7,10:6,11:27,12:30,13:30,14:3,15:30,16:30,17:19,18:22,19:23,20:29,21:20,22:30,23:30,24:24,25:28,26:21,27:25,28:12,29:11,31:0,34:2,36:2,37:2,38:3,39:30,40:30,41:30,42:30,43:30,44:30,45:8,48:0,49:3,53:2,54:4,59:13,60:14,61:30,62:15,63:30,64:30,74:18,75:30,76:30,77:10,85:16,86:17,88:9},this.inputTable=[[0,8,1],[9,9,41],[10,10,40],[11,11,1],[12,12,41],[13,13,40],[14,31,1],[32,32,41],[33,33,1],[34,34,21],[35,35,1],[36,36,23],[37,37,10],[38,38,1],[39,39,2],[40,40,9],[41,41,4],[42,42,1],[43,43,22],[44,44,19],[45,45,20],[46,46,38],[47,47,42],[48,48,39],[49,57,16],[58,58,1],[59,59,5],[60,60,1],[61,61,13],[62,63,1],[64,64,23],[65,68,26],[69,69,37],[70,70,26],[71,87,23],[88,88,33],[89,90,23],[91,91,12],[92,92,0],[93,93,11],[94,94,1],[95,95,23],[96,96,1],[97,97,8],[98,98,26],[99,99,7],[100,100,14],[101,101,36],[102,102,27],[103,103,23],[104,104,32],[105,107,23],[108,108,17],[109,109,35],[110,110,30],[111,111,25],[112,112,31],[113,113,23],[114,114,29],[115,115,18],[116,116,15],[117,117,28],[118,119,23],[120,120,34],[121,121,24],[122,122,23],[123,123,6],[124,124,1],[125,125,3],[126,65535,1]],this.initialTable={STRING:1,INITIAL:2}}return n.lexSeq=function(e){var t=new n;t.source=e;for(var r=[],a=t.token;"<$>"!==a;)r.push({token:a,text:t.yytext,start:t.startIdx,end:t.endIdx}),t.advance(),a=t.token;return r},n.prototype.yyrestart=function(e){void 0===e&&(e=null),null!=e&&(this.sourceString=e),this.ended=!1,this.start=0,this.oldStart=0,this.line=1,this.col=0,this.advanced=!0,this.tokenNameString=null,this.yyObject={},this.initialState="INITIAL"},Object.defineProperty(n.prototype,"source",{set:function(e){this.sourceString=e,this.yyrestart()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"token",{get:function(){return this.advanced&&(this.tokenNameString=this.next(),this.advanced=!1),this.tokenNameString},enumerable:!0,configurable:!0}),n.prototype.advance=function(){this.advanced=!0},Object.defineProperty(n.prototype,"startIdx",{get:function(){return this.oldStart},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"endIdx",{get:function(){return this.start},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"position",{get:function(){return[this.line,this.col]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positionInfo",{get:function(){return this.token+"@row:"+this.position.join("col:")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"yytext",{get:function(){return this.yyText},set:function(e){this.yyText=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"yyleng",{\nget:function(){return this.endIdx-this.startIdx},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"yy",{get:function(){return this.yyObject},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"tokenName",{get:function(){return this.tokenNameString},enumerable:!0,configurable:!0}),n.prototype.next=function(){for(var e,t,r,a,n,s,i,o,l;;)for(t=e=null,r=0,a=this.start,n=this.start,s=p,o=u,l=this.start,i=this.transTable[0][1][this.initialInput];;){if(r=this.sourceString.charCodeAt(n),s!==p&&(13===r?(this.col=0,this.line++):10===r?13!==s&&(this.col=0,this.line++):this.col++),s=r,(t=this.trans(i,r))===u){if(a===l){if(this.start!==this.sourceString.length)throw new Error("意外的字符,line:"+this.position.join(",col:")+"of "+this.sourceString.substr(a,20));if(!1===this.ended)return this.ended=!0,"<$>";throw new Error("已经到达末尾.")}switch(e=this.finalTable[o],this.start=l,this.oldStart=a,this.yyText=this.sourceString.substring(this.startIdx,this.endIdx),e){case 2:return"time";case 3:return"number";case 4:return"hex";case 5:return"+";case 6:return"-";case 7:return this.begin("STRING"),"str_start";case 8:return"str_esc_char";case 9:return"str_esc_unicode";case 10:return"str_esc_ascii";case 11:return this.begin("INITIAL"),"str_end";case 12:return"str_seg";case 13:return"set";case 14:return"let";case 15:return"def";case 16:return"apply";case 17:return"clone";case 18:return"then";case 19:return"=";case 20:return"(";case 21:return")";case 22:return"[";case 23:return"]";case 24:return"{";case 25:return"}";case 26:return".";case 27:return",";case 28:return";";case 29:return"%";case 30:return"id"}break}null!=(e=this.finalTable[t])&&(o=t,l=n+1),n+=1,i=t}},n.prototype.trans=function(e,t){if(isNaN(t))return u;if(t<this.inputTable[0][0]||t>this.inputTable[this.inputTable.length-1][1])throw new Error("输入超出有效范围,line:"+this.position.join(",col:"));if(!0===this.transTable[e][0])return u;var r=this.find(t,this.inputTable),a=this.find(r,this.transTable[e][2]);return this.transTable[e][1][a]},n.prototype.find=function(e,t){var r,a,n;for(r=0,a=t.length-1;;){if(t[n=r+a>>>1][0]<=e&&t[n][1]>=e)return t[n][2];t[n][0]>e?a=n-1:r=n+1}},n.prototype.begin=function(e){void 0===e&&(e=null),this.initialState=null!=e?e:"INITIAL"},Object.defineProperty(n.prototype,"initialState",{get:function(){return this.initialStateString},set:function(e){if(void 0===this.initialTable[e])throw new Error("未定义的起始状态:"+e);this.initialStateString=e,this.initialInput=this.initialTable[e]},enumerable:!0,configurable:!0}),n}(),v=function(){function r(){this.ast_helper=new a,this.actionTable=[null,{0:6,1:1,2:2,67:54,68:36,69:20,70:16,8:4,9:8,10:10,76:12,77:32,78:50,73:148,74:44,85:52,89:14,90:150,29:18,101:120,41:150,43:36,47:104,112:40,115:34,116:38,120:56,124:150,125:42},{0:6,2:9,67:54,4:22,69:20,70:16,8:4,9:8,10:10,76:12,77:32,14:9,73:148,18:9,85:52,78:50,24:28,25:9,90:150,74:44,29:18,68:36,89:14,36:26,101:120,41:150,43:36,47:104,112:40,115:34,116:38,120:56,124:150,125:42},{3:25,5:33,6:35,7:37,12:43,16:57,19:68,21:43,23:68,26:68,28:43,30:87,31:68,32:95,35:87,38:87,39:68,40:68,44:66,45:87,47:104,48:106,53:102,54:98,61:96,62:100,64:132,65:134,66:68,71:87,72:87,75:187,79:68,80:201,82:140,86:95,87:112,88:87,92:64,93:94,94:70,95:90,96:92,98:87,101:120,106:239,107:138,109:110,110:108,113:46,114:72,117:136,121:68,122:87},{0:6,2:11,67:54,4:22,69:20,70:16,8:4,9:8,10:10,11:41,68:36,13:49,14:11,73:148,18:11,20:65,77:32,78:50,124:150,24:28,25:11,90:150,27:81,92:161,29:18,33:135,34:30,91:229,36:26,74:44,85:52,76:12,41:150,89:14,43:36,101:120,46:161,47:104,112:40,115:34,99:161,120:56,116:38,125:42},{19:68,23:68,24:28,25:24,29:18,30:89,31:68,35:139,36:26,37:141,39:68,43:36,44:66,45:159,47:104,48:106,53:102,54:98,61:96,62:100,64:132,65:134,66:68,68:36,69:20,70:16,71:183,76:12,77:32,79:68,82:140,87:112,88:225,89:14,92:64,93:94,94:70,95:90,96:92,98:237,101:120,107:138,109:110,110:108,113:46,114:72,115:34,116:38,117:136,121:68,122:48,123:251},{0:6,2:13,67:54,4:22,69:20,70:16,8:4,9:8,10:10,76:12,77:32,14:13,73:148,18:13,85:52,78:50,24:28,25:13,90:150,74:44,29:18,68:36,89:14,36:26,\n101:120,41:150,43:36,47:104,112:40,115:34,116:38,120:56,124:150,125:42},{3:27,20:67,21:45,27:83,12:45,28:45,15:55},{64:132,65:134,67:54,94:70,117:136,72:185,120:56,111:243,78:50,82:140,85:52,22:71,87:112,26:68,92:64,93:94,86:80,95:90,32:80,33:137,100:84,101:120,38:143,40:68,107:138,44:66,109:110,110:108,47:104,48:106,96:92,114:72,108:76,53:102,54:98,55:173,56:74,57:78,58:82,59:86,60:88,61:96,62:100},{36:39,69:20,70:16,10:39,43:36,76:12,77:32,47:104,115:34,116:38,68:36,101:120,24:39,89:14,29:18},{64:132,65:134,117:136,118:144,77:197,82:140,83:146,84:215,87:112,92:64,93:94,94:231,95:90,96:92,100:84,101:120,107:138,109:110,110:108,47:104,48:106,53:102,54:98,119:142,57:175,58:82,59:86,60:88,61:96,62:100},{0:6,2:15,67:54,68:36,69:20,70:16,8:4,9:8,10:10,76:12,77:32,78:50,73:148,74:44,85:52,89:14,90:150,29:18,101:120,41:150,43:36,47:104,112:40,115:34,116:38,120:56,124:150,125:42},{0:6,2:17,67:54,68:36,69:20,70:16,8:4,9:8,10:10,76:12,77:32,78:50,73:148,74:44,85:52,89:14,90:150,29:18,101:120,41:150,43:36,47:104,112:40,115:34,116:38,120:56,124:150,125:42},{17:59,42:153,46:163},{32:97,75:97,52:97,86:97,80:97,106:97,43:97,68:97},{32:99,80:99,106:99,75:99,52:99,86:99},{32:118,49:114,50:116,52:118,86:118,80:118,106:118,75:118,63:177},{87:221},{32:101,80:101,106:101,75:101,52:101,86:101},{32:103,80:103,106:103,75:103,52:103,86:103},{32:105,97:105,52:105,86:105,80:105,106:105,75:105},{104:126,81:205,105:128,51:130,102:122,103:124},{104:126,81:207,105:128,51:130,102:122,103:124},{104:126,81:209,105:128,51:130,102:122,103:124},{104:126,81:211,105:128,51:130,102:122,103:124},{104:126,81:213,105:128,51:130,102:122,103:124},{32:107,80:107,75:107,86:107},{101:120,118:144,109:110,110:108,47:104,48:106,83:146,52:167,53:102,54:98,87:112,84:217,61:96,62:100,119:142},{67:54,85:52,120:56,41:149,90:149,124:149,78:50}],this.gotoTable={64:{52:171},29:{0:5},30:{0:7},31:{2:19},32:{2:21},33:{25:75,18:61,2:23,14:51},34:{79:199,23:73,19:63,39:145,40:147,121:247,26:79,66:179,31:93},35:{68:181,43:155},36:{3:29},37:{4:31},38:{14:53},39:{25:77},40:{12:47,21:69,28:85},41:{32:109,75:109,52:109,86:109,80:109,106:109,43:157,68:157},42:{97:233},43:{32:111,97:235,52:111,86:111,80:111,106:111,75:111},44:{124:253,41:151,90:227},45:{113:245},46:{122:249},47:{32:113},49:{75:189},50:{88:91,98:91,35:91,38:91,71:91,72:91,122:91,45:91,30:91},51:{75:191},52:{32:115,86:219},53:{32:117,86:117},54:{32:119,80:203,86:119},55:{32:121,80:121,106:241,75:193,52:169,86:121},56:{32:123,80:123,75:195,86:123},57:{32:125,80:125,106:125,75:125,52:125,86:125},58:{32:127,80:127,106:127,75:127,52:127,86:127},59:{32:129,80:129,106:129,75:129,52:129,86:129},60:{87:223},61:{51:165},62:{32:131,80:131,75:131,86:131},63:{32:133,80:133,75:133,86:133}},this.prodList=[[65,2],[29,1],[30,2],[30,0],[31,1],[31,1],[33,6],[33,6],[33,5],[33,3],[33,5],[37,0],[39,0],[38,2],[38,1],[36,3],[35,1],[35,3],[35,0],[42,1],[32,7],[32,12],[32,5],[45,0],[46,0],[40,4],[40,4],[40,3],[40,6],[48,3],[48,1],[48,0],[49,1],[34,2],[34,0],[50,3],[50,4],[47,1],[52,3],[52,1],[52,0],[53,1],[53,3],[54,1],[54,1],[51,1],[51,1],[51,1],[55,1],[55,1],[55,1],[55,1],[41,1],[58,1],[57,3],[60,1],[60,0],[59,1],[59,1],[59,0],[43,3],[61,2],[61,2],[61,2],[61,2],[61,0],[56,1],[56,1],[63,4],[62,3],[62,2],[64,3],[64,3],[64,1],[44,1],[44,0]],this.inputTable={"<$>":1,set:2,id:3,"{":4,"}":5,apply:6,"(":7,")":8,then:9,",":10,def:11,let:12,"=":13,time:14,hex:15,number:16,"%":17,"+":18,"-":19,str_start:20,str_end:21,str_esc_char:22,str_esc_unicode:23,str_esc_ascii:24,str_seg:25,"[":26,"]":27,";":28}}return r.parse=function(e){var t=new n;return t.source=e,(new r).parseLexer(t)},r.prototype.parseLexer=function(e){for(var t,r,a,n=[0],s=[];;){if(r=e.token,t=n[n.length-1],null==this.actionTable[this.inputTable[r]][t])throw new Error("Parse Error:"+e.positionInfo);if(1===(a=this.actionTable[this.inputTable[r]][t]))return s.pop();if(1==(1&a))s.push(e.yytext),n.push((a>>>1)-1),e.advance();else if(0==(1&a)){var i=a>>>1,o=this.prodList[i][1],l=null;switch(0<o&&(l=s[s.length-o]),i){case 1:l=this.ast_helper.on_Result(s[s.length-1]);break;case 2:(l=s[s.length-2]\n).push(s[s.length-1]);break;case 3:l=[];break;case 4:break;case 5:l={type:"SetExpr",params:s[s.length-1]};break;case 6:l=this.ast_helper.on_unit_set_expr(s[s.length-5],s[s.length-3],s[s.length-1]);break;case 7:l=this.ast_helper.on_temporary_target_set_expr(s[s.length-5],s[s.length-3],s[s.length-1]);break;case 8:l={type:"ApplyExpr",params:[s[s.length-4],s[s.length-2]]};break;case 9:l=this.ast_helper.on_then_set_expr(s[s.length-3],s[s.length-1]);break;case 10:l=this.ast_helper.on_group_set_expr(s[s.length-3]);break;case 11:this.ast_helper.on_enter_scope();break;case 12:this.ast_helper.on_leave_scope();break;case 13:(l=s[s.length-2]).push(s[s.length-1]);break;case 14:l=[s[s.length-1]];break;case 15:l=s[s.length-2];break;case 16:l=[s[s.length-1]];break;case 17:l=[s[s.length-3],s[s.length-1]];break;case 18:l=[];break;case 19:break;case 20:l=this.ast_helper.on_def_object(s[s.length-6],s[s.length-5],s[s.length-3]);break;case 21:l=this.ast_helper.on_def_template(s[s.length-11],s[s.length-10],s[s.length-8],s[s.length-4]);break;case 22:l=this.ast_helper.on_let_object_binding(s[s.length-4],s[s.length-2]);break;case 23:this.ast_helper.on_enter_tpl();break;case 24:this.ast_helper.on_leave_tpl();break;case 25:l=this.ast_helper.on_object_modification(s[s.length-4],s[s.length-2]);break;case 26:l=this.ast_helper.on_template_application(s[s.length-4],s[s.length-2]);break;case 27:l=s[s.length-2];break;case 28:l=this.ast_helper.on_tmp_object_modification(s[s.length-5],s[s.length-3]);break;case 29:(l=s[s.length-3]).push(s[s.length-1]);break;case 30:l=[s[s.length-1]];break;case 31:l=[];break;case 32:l=this.ast_helper.on_Variable_value(s[s.length-1]);break;case 33:(l=s[s.length-2]).push(s[s.length-1]);break;case 34:l=[];break;case 35:l=[s[s.length-3],s[s.length-1]];break;case 36:l=[s[s.length-4],s[s.length-2]];break;case 37:l=this.ast_helper.on_ArgList(s[s.length-1]);break;case 38:(l=s[s.length-1]).unshift(s[s.length-3]);break;case 39:l=[s[s.length-1]];break;case 40:l=[];break;case 41:l=[null,s[s.length-1]];break;case 42:l=[s[s.length-3],s[s.length-1]];break;case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:case 51:break;case 52:l=this.ast_helper.on_Time_value(s[s.length-1]);break;case 53:l=this.ast_helper.on_Hex_value(s[s.length-1]);break;case 54:l=this.ast_helper.on_Num_value(s[s.length-3],s[s.length-2],s[s.length-1]);break;case 55:case 56:case 57:case 58:break;case 59:l="+";break;case 60:l=this.ast_helper.on_String_value(s[s.length-2]);break;case 61:(l=s[s.length-2]).push({type:"char",value:s[s.length-1]});break;case 62:(l=s[s.length-2]).push({type:"unicode",value:s[s.length-1]});break;case 63:(l=s[s.length-2]).push({type:"ascii",value:s[s.length-1]});break;case 64:(l=s[s.length-2]).push({type:"seg",value:s[s.length-1]});break;case 65:l=[];break;case 66:case 67:break;case 68:l=this.ast_helper.on_Object_value(s[s.length-4],this.ast_helper.on_KeyValue_list(s[s.length-4],s[s.length-2]));break;case 69:l=this.ast_helper.on_Array_value(s[s.length-2]);break;case 70:l=this.ast_helper.on_Array_value([]);break;case 71:case 72:(l=s[s.length-3]).push(s[s.length-1]);break;case 73:l=[s[s.length-1]]}for(var u=0;u<o;)n.pop(),s.pop(),u++;if(t=n[n.length-1],null==this.gotoTable[this.prodList[i][0]][t])throw new Error("Goto Error!"+e.positionInfo);a=this.gotoTable[this.prodList[i][0]][t],n.push((a>>>1)-1),s.push(l)}}},r}();var s=function(e,t){void 0===t&&(t=!0);var r={x:{numType:"number",value:0},y:{numType:"number",value:0},zIndex:{numType:"number",value:0},scale:{numType:"number",value:1},duration:void 0},a={content:"请输入内容",alpha:{numType:"number",value:1},color:16777215,anchorX:{numType:"number",value:0},anchorY:{numType:"number",value:0},fontSize:{numType:"number",value:25},fontFamily:"SimHei",bold:{numType:"number",value:1},textShadow:{numType:"number",value:1},strokeWidth:{numType:"number",value:0},strokeColor:16777215,rotateX:{numType:"number",value:0},rotateY:{numType:"number",value:0},rotateZ:{numType:"number",value:0},parent:void 0},n={text:"请输入内容",fontSize:{numType:"number",value:25},textColor:0,textAlpha:{numType:"number",value:1},\nfillColor:16777215,fillAlpha:{numType:"number",value:1},target:void 0},s={d:void 0,viewBox:void 0,borderColor:0,borderAlpha:{numType:"number",value:1},borderWidth:{numType:"number",value:0},fillColor:16777215,fillAlpha:{numType:"number",value:1}};function i(e){for(var t in e)if(e.hasOwnProperty(t))switch(void 0!==e[t].value&&void 0!==e[t].value.numType&&void 0===e[t].easing?e[t]=e[t].value:void 0!==e[t].value&&void 0!==e[t].type&&(e[t]=e[t].value),t){case"content":e[t]=f(e[t],!1,!0);break;case"fontFamily":e[t]=f(e[t],!0,!1);break;case"parent":e[t]=f(e[t],!1,!1);break;case"text":e[t]=f(e[t],!1,!0);break;case"d":case"viewBox":e[t]=f(e[t],!0,!1);break;default:"string"==typeof e[t]&&(e[t]=f(e[t],!1,!1))}}function o(e){i(e.attrs),e.duration=e.duration.value,e.defaultEasing=e.default_easing&&e.default_easing.value,e.targetName=e.target_name}try{var l=v.parse(e),u={};u.defs=l.defs;for(var p=0;p<u.defs.length;p++){if(i(u.defs[p].attrs),u.defs[p].attrs.target){for(var h={objType:"seek"},c=0;c<u.defs[p].attrs.target.length;c++){var _=u.defs[p].attrs.target[c];"seasonId"===_[0]||"episodeId"===_[0]?h.objType="bangumi":"av"!==_[0]&&"page"!==_[0]||(h.objType="av"),_[1].value&&_[1].value.value?h[_[0]]=_[1].value.value:_[1].value&&(h[_[0]]=_[1].value)}u.defs[p].attrs.target=h}u.defs[p].attrs=b(r,l.defs[p].attrs),"DefText"===u.defs[p].type?u.defs[p].attrs=b(a,l.defs[p].attrs):"DefButton"===u.defs[p].type?u.defs[p].attrs=b(n,l.defs[p].attrs):"DefPath"===u.defs[p].type&&(u.defs[p].attrs=b(s,l.defs[p].attrs))}for(u.sets=l.sets,p=0;p<u.sets.length;p++)if(u.sets[p].items)for(c=0;c<u.sets[p].items.length;c++)u.sets[p].items[c].attrs&&o(u.sets[p].items[c]);else o(u.sets[p]);return u}catch(e){throw new Error(e.message)}},i=self;i.addEventListener("message",function(e){var t=e.data;try{var r=s(t.text);t.defs=r.defs,t.sets=r.sets,i.postMessage(t)}catch(e){console.warn("Error in BAS parser: ",e),i.postMessage({error:e.message})}})}]);'
,null)}},function(e,t,r){var a=r(2);"string"==typeof a&&(a=[[e.i,a,""]]);var n={attrs:{"data-injector":"bilibili-player"},hmr:!0,transform:void 0,insertInto:void 0};r(4)(a,n);a.locals&&(e.exports=a.locals)},function(e,t,r){(e.exports=r(3)(!1)).push([e.i,".bas-danmaku{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:absolute;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);left:50%;top:50%;box-sizing:border-box;width:100%;height:100%;background:transparent;z-index:10}.bas-danmaku.bas-danmaku-pause .bas-danmaku-item{-webkit-animation-play-state:paused;animation-play-state:paused}.bas-danmaku>canvas{pointer-events:auto}.bas-danmaku-item{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:absolute;animation-fill-mode:forwards;-webkit-animation-fill-mode:forwards;line-height:1;-webkit-transform-origin:0 0;transform-origin:0 0}.bas-danmaku-item .bas-danmaku-item{position:absolute;left:0;top:0}.bas-danmaku-item.bas-danmaku-item-button{pointer-events:auto;padding:10px 20px;border-radius:3px}.bas-danmaku-item-wrap{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:absolute;left:0;right:0;top:0;height:100%;z-index:10}.bas-danmaku-item-inner{border:0;-webkit-transform-origin:0 0;transform-origin:0 0}.bas-danmaku-item-text .bas-danmaku-item-inner{pointer-events:none;border-style:solid}",""])},function(e,t,r){"use strict";e.exports=function(r){var i=[];return i.toString=function(){return this.map(function(e){var t=function(e,t){var r=e[1]||"",a=e[3];if(!a)return r;if(t&&"function"==typeof btoa){var n=(i=a,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */"),s=a.sources.map(function(e){return"/*# sourceURL="+a.sourceRoot+e+" */"});return[r].concat(s).concat([n]).join("\n")}var i;return[r].join("\n")}(e,r);return e[2]?"@media "+e[2]+"{"+t+"}":t}).join("")},i.i=function(e,t){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},a=0;a<this.length;a++){var n=this[a][0];null!=n&&(r[n]=!0)}for(a=0;a<e.length;a++){var s=e[a];null!=s[0]&&r[s[0]]||(t&&!s[2]?s[2]=t:t&&(s[2]="("+s[2]+") and ("+t+")"),i.push(s))}},i}},function(e,t,a){var r,n,s,l={},u=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===n&&(n=r.apply(this,arguments)),n}),i=(s={},function(e,t){if("function"==typeof e)return e();if(void 0===s[e]){var r=function(e,t){return t?t.querySelector(e):document.querySelector(e)}.call(this,e,t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}s[e]=r}return s[e]}),p=null,h=0,o=[],c=a(5);function f(e,t){for(var r=0;r<e.length;r++){var a=e[r],n=l[a.id];if(n){n.refs++;for(var s=0;s<n.parts.length;s++)n.parts[s](a.parts[s]);for(;s<a.parts.length;s++)n.parts.push(g(a.parts[s],t))}else{var i=[];for(s=0;s<a.parts.length;s++)i.push(g(a.parts[s],t));l[a.id]={id:a.id,refs:1,parts:i}}}}function d(e,t){for(var r=[],a={},n=0;n<e.length;n++){var s=e[n],i=t.base?s[0]+t.base:s[0],o={css:s[1],media:s[2],sourceMap:s[3]};a[i]?a[i].parts.push(o):r.push(a[i]={id:i,parts:[o]})}return r}function b(e,t){var r=i(e.insertInto);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var a=o[o.length-1];if("top"===e.insertAt)a?a.nextSibling?r.insertBefore(t,a.nextSibling):r.appendChild(t):r.insertBefore(t,r.firstChild),o.push(t);else if("bottom"===e.insertAt)r.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var n=i(e.insertAt.before,r);r.insertBefore(t,n)}}function m(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=o.indexOf(e);0<=t&&o.splice(t,1)}function v(e){
var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var r=function(){0;return a.nc}();r&&(e.attrs.nonce=r)}return _(t,e.attrs),b(e,t),t}function _(t,r){Object.keys(r).forEach(function(e){t.setAttribute(e,r[e])})}function g(t,e){var r,a,n,s,i,o;if(e.transform&&t.css){if(!(s="function"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=s}if(e.singleton){var l=h++;r=p||(p=v(e)),a=w.bind(null,r,l,!1),n=w.bind(null,r,l,!0)}else n=t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=e,o=document.createElement("link"),void 0===i.attrs.type&&(i.attrs.type="text/css"),i.attrs.rel="stylesheet",_(o,i.attrs),b(i,o),a=function(e,t,r){var a=r.css,n=r.sourceMap,s=void 0===t.convertToAbsoluteUrls&&n;(t.convertToAbsoluteUrls||s)&&(a=c(a));n&&(a+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */");var i=new Blob([a],{type:"text/css"}),o=e.href;e.href=URL.createObjectURL(i),o&&URL.revokeObjectURL(o)}.bind(null,r=o,e),function(){m(r),r.href&&URL.revokeObjectURL(r.href)}):(r=v(e),a=function(e,t){var r=t.css,a=t.media;a&&e.setAttribute("media",a);if(e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}.bind(null,r),function(){m(r)});return a(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;a(t=e)}else n()}}e.exports=function(e,i){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(i=i||{}).attrs="object"==typeof i.attrs?i.attrs:{},i.singleton||"boolean"==typeof i.singleton||(i.singleton=u()),i.insertInto||(i.insertInto="head"),i.insertAt||(i.insertAt="bottom");var o=d(e,i);return f(o,i),function(e){for(var t=[],r=0;r<o.length;r++){var a=o[r];(n=l[a.id]).refs--,t.push(n)}e&&f(d(e,i),i);for(r=0;r<t.length;r++){var n;if(0===(n=t[r]).refs){for(var s=0;s<n.parts.length;s++)n.parts[s]();delete l[n.id]}}}};var y,k=(y=[],function(e,t){return y[e]=t,y.filter(Boolean).join("\n")});function w(e,t,r,a){var n=r?"":a.css;if(e.styleSheet)e.styleSheet.cssText=k(t,n);else{var s=document.createTextNode(n),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(s,i[t]):e.appendChild(s)}}},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,s=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var r,a=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(a)?e:(r=0===a.indexOf("//")?a:0===a.indexOf("/")?n+a:s+a.replace(/^\.\//,""),"url("+JSON.stringify(r)+")")})}},function(e,t,r){"use strict";var n=window.URL||window.webkitURL;e.exports=function(t,r){try{try{var a;try{(a=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(t),a=a.getBlob()}catch(e){a=new Blob([t])}return new Worker(n.createObjectURL(a))}catch(e){return new Worker("data:application/javascript,"+encodeURIComponent(t))}}catch(e){if(!r)throw Error("Inline worker is not supported");return new Worker(r)}}},function(e,t,r){"use strict";r.r(t);r(1);var _={extend:function(e,t){var r={};for(var a in e)e.hasOwnProperty(a)&&(r[a]=e[a]);for(var a in t)t.hasOwnProperty(a)&&(r[a]=t[a]);return r},escapeSpecialChars:function(e){return e.replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\f/g,"\\f")},nowTime:function(){return performance?performance.now():+new Date},string2DOM:function(e){return $(e)[0]},colorFromInt:function(e){return"#"+("00000"+e.toString(16)).slice(-6)},rgbaFormat:function(e,t){var r=(
"00000"+e.toString(16)).slice(-6);return"rgba("+parseInt(r.slice(0,2),16)+","+parseInt(r.slice(2,4),16)+","+parseInt(r.slice(4,6),16)+","+t+")"},htmlEncode:function(e,t,r){return r||(e=e.replace(/&/g,"").replace(/</g,"").replace(/>/g,"").replace(/"/g,"").replace(/'/g,"").replace(/\//g,"").replace(/:/g,"").replace(/;/g,"")),e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2f;").replace(/ /g,t?" ":"&nbsp;").replace(/\n/g,"<br>")},browser:{get version(){var e=navigator.userAgent.toLowerCase(),t=/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.test(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.test(e),r=/(chrome)[ \/]([\w.]+)/.exec(e)||"",a={browser:r[5]||r[3]||r[1]||"",version:r[4]||r[2]||"0"},n=0;return a.browser&&(n=parseInt(a.version,10)),{browser:a.browser,version:n,linux:/Linux/i.test(e),webKit:/AppleWebKit/i.test(e),gecko:/Gecko/i.test(e)&&!/KHTML/i.test(e),trident:/Trident/i.test(e),presto:/Presto/i.test(e),mobile:/AppleWebKit.*Mobile.*/i.test(e),iOS:/Mac OS X[\s_\-\/](\d+[.\-_]\d+[.\-_]?\d*)/i.test(e),iPhone:/iPhone/i.test(e),iPad:/iPad/i.test(e),webApp:!/Safari/i.test(e),android:/Android/i.test(e),windowsPhone:/Windows Phone/i.test(e),microMessenger:/MicroMessenger/i.test(e),msie:/msie [\w.]+/i.test(e),edge:/edge/i.test(e),edgeBuild16299:/(\s|^)edge\/16.16299(\s|$)/i.test(e),safari:t,safariSupportMSE:t&&/Version\/1\d/i.test(e)}}}},i=function(){function e(e){this.prefix=["","-webkit-"],this.endProgress={},this.xProportion=e.container.offsetWidth/100,this.yProportion=e.container.offsetHeight/100,this.container=e.container,this.dm=e.dm,this.percentObj2Num(this.dm),this.defs=this.dm.defs,this.sets=this.dm.sets,this.startTime=e.startTime,this.player=e.player,this.animationEndCallback=e.animationEndCallback,this.init()}return e.prototype.init=function(){var e=this.itemsTemplate();if(e){var t=100*this.xProportion/2/Math.tan(Math.PI/180*27.5);this.ele=_.string2DOM('<div class="bas-danmaku-item-wrap" style="perspective:'+t+"px;-webkit-perspective:"+t+'px;">'+this.animationTemplate()+e+"</div>");for(var r=0;r<this.defs.length;r++){var a=this.defs[r].name;this.endProgress[a]=0,this.transience(a)}this.bindEvents(this.ele)}},e.prototype.animationCallback=function(e){var t=e.animationName.split("-")[2];this.endProgress[t]?this.endProgress[t]++:this.endProgress[t]=1,this.transience(t),this.animationEndCallback(this),this.endProgress[t]!==this.dm.def2set[t].length&&"duration"!==e.animationName.split("-")[3]||(e.target.parentNode.removeChild(e.target),0===this.ele.getElementsByClassName("bas-danmaku-item").length&&this.container.removeChild(this.ele))},e.prototype.transience=function(e){var t=this.endProgress[e],r=this.dm.def2set[e][t];if(r&&r.valueEnd&&(r.valueEnd.content&&(this.ele.querySelector(".bas-danmaku-item--"+e+" .bas-danmaku-item-inner").innerHTML=r.valueEnd.content),r.valueEnd.text&&(this.ele.querySelector(".bas-danmaku-item--"+e+" .bas-danmaku-item-inner").innerHTML=r.valueEnd.text),r.valueEnd.fontSize)){var a=r.valueEnd.fontSize;12<=a?this.ele.querySelector(".bas-danmaku-item--"+e+" .bas-danmaku-item-inner").style.fontSize=a+"px":(this.ele.querySelector(".bas-danmaku-item--"+e+" .bas-danmaku-item-inner").style.fontSize="12px",this.ele.querySelector(".bas-danmaku-item--"+e+" .bas-danmaku-item-inner").style.transform="scale("+a/12+")")}},e.prototype.percentObj2Num=function(e){for(var a=this,t=function(e){for(var t in e)if(e.hasOwnProperty(t)){var r=void 0;if(e[t].numType)r=e[t];else{if(!e[t].value||!e[t].value.numType)continue;r=e[t].value}if("number"===r.numType)switch(t){case"x":r=r.value/a.xProportion;break;case"y":r=r.value/a.yProportion;break;default:r=r.value}else if("percent"===r.numType)switch(t){case"fontSize":case"width":r=r.value*a.xProportion;break;case"height":r=r.value*a.yProportion;break;default:r=r.value}e[t].numType?e[t]=r:e[t].value&&e[t].value.numType&&(e[t].value=r)}},r=0;r<e.defs.length;r++)t(e.defs[r].attrs);for(r=0;r<e.sets.length;r++)if(e.sets[r].items)for(
var n=0;n<e.sets[r].items.length;n++)t(e.sets[r].items[n].attrs);else t(e.sets[r].attrs);for(var s in e.def2set)if({}.hasOwnProperty.call(e.def2set,s))for(r=0;r<e.def2set[s].length;r++)t(e.def2set[s][r].valueEnd),t(e.def2set[s][r].valueStart)},e.prototype.itemsTemplate=function(){for(var e="",t=0;t<this.defs.length;t++)this.defs[t].attrs.parent||(e+=this.itemsTemplateOne(this.defs[t]));return e},e.prototype.itemsTemplateOne=function(e,t,r){var n=this;void 0===t&&(t=this.xProportion),void 0===r&&(r=this.yProportion);var a,s=function(e,t){for(var r="",a=0;a<e.length;a++)r+="duration"===t?e[a][t]+"s":"delay"===t?e[a][t]-n.startTime+"s":e[a][t],a!==e.length-1&&(r+=",");return r},i=e.attrs,o=this.dm.def2set[e.name],l=""+this.prefixCSS("animation-name",s(o,"name"))+this.prefixCSS("animation-duration",s(o,"duration"))+this.prefixCSS("animation-timing-function",s(o,"easing"))+this.prefixCSS("animation-delay",s(o,"delay"));for(var u in i)i.hasOwnProperty(u)&&(l+=this.getStyleOut(u,i[u]));switch(e.type){case"DefText":var p="";(i.rotateX||i.rotateY||i.rotateZ)&&(p=" rotateX("+i.rotateX+"deg) rotateY("+i.rotateY+"deg) rotateZ("+i.rotateZ+"deg)"),l+="transform:translate("+i.x*t+"px, "+i.y*r+"px)"+p+" scale("+i.scale+");",a=this.getStyleIn(i);var h="";for(u=0;u<this.defs.length;u++)this.defs[u].attrs.parent===e.name&&(this.defSize(e),h+=this.itemsTemplateOne(this.defs[u],e.attrs.width/100,e.attrs.height/100));return'<div class="bas-danmaku-item bas-danmaku-item-text bas-danmaku-item--'+e.name+'" style="'+l+'"><div class="bas-danmaku-item-inner" style="'+a+'">'+i.content+h+"</div></div>";case"DefButton":return l+="transform:translate("+i.x*t+"px, "+i.y*r+"px) scale("+i.scale+");color:"+_.rgbaFormat(i.textColor,i.textAlpha)+";background-color:"+_.rgbaFormat(i.fillColor,i.fillAlpha)+";",a=this.getStyleIn(i),'<div class="bas-danmaku-item bas-danmaku-item-button bas-danmaku-item--'+e.name+'" style="'+l+'"><div class="bas-danmaku-item-inner" style="'+a+'">'+i.text+"</div></div>";case"DefPath":l+="transform:translate("+i.x*t+"px, "+i.y*r+"px);",a=this.getStyleIn(i);var c=void 0;i.viewBox?c=i.width||i.height?'viewBox="'+i.viewBox+'" '+(i.width?'width="'+i.width*(i.scale||1)+'"':"")+" "+(i.height?'height="'+i.height*(i.scale||1)+'"':""):'viewBox="'+i.viewBox+'" width="'+parseInt(i.viewBox.split(" ")[2],10)*(i.scale||1)+'"':i.scale&&(c='style="transform:scale('+i.scale+');transform-origin: 0 0;overflow:visible;"');var f='fill="'+_.rgbaFormat(i.fillColor,i.fillAlpha)+'" stroke="'+_.rgbaFormat(i.borderColor,i.borderAlpha)+'" stroke-width="'+i.borderWidth+'" d="'+i.d+'"';return'<div class="bas-danmaku-item bas-danmaku-item-path bas-danmaku-item--'+e.name+'" style="'+l+'"><div class="bas-danmaku-item-inner" style="'+a+'"><svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg" '+c+"><path "+f+"></svg></div></div>"}},e.prototype.findParent=function(e){for(var t=0;t<this.defs.length;t++)if(this.defs[t].name===e)return this.defs[t];return null},e.prototype.defSize=function(e){!e||e.attrs.width&&e.attrs.height||(this.measureCanvas||(this.measureCanvas=document.createElement("canvas").getContext("2d")),this.measureCanvas.font=(e.attrs.bold?"bold ":"")+" "+e.attrs.fontSize+"px "+e.attrs.fontFamily,e.attrs.width=this.measureCanvas.measureText(e.attrs.content).width,e.attrs.height=e.attrs.fontSize)},e.prototype.getStyleIn=function(e){var t="",r="";return e.strokeWidth&&e.strokeColor&&(t+="-webkit-text-stroke:"+e.strokeWidth+"px "+_.colorFromInt(e.strokeColor)+";"),e.hasOwnProperty("fontFamily")&&(t+="font-family:&quot;"+e.fontFamily.split(",").join("&quot;,&quot;")+"&quot;,sans-serif;"),e.hasOwnProperty("textShadow")&&(t+="text-shadow:"+(e.textShadow?"rgb(0, 0, 0) 1px 0px 1px, rgb(0, 0, 0) 0px 1px 1px, rgb(0, 0, 0) 0px -1px 1px, rgb(0, 0, 0) -1px 0px 1px":"none")+";"),e.hasOwnProperty("bold")&&(t+="font-weight:"+(e.bold?"bold":"normal")+";"),e.hasOwnProperty("fontSize")&&(12<=e.fontSize?t+="font-size:"+e.fontSize+"px;":(t+="font-size:12px;",r+="scale("+e.fontSize/12+") ")),e.hasOwnProperty("anchorX")&&e.hasOwnProperty("anchorY")&&(
r+="translate("+100*-e.anchorX+"%,"+100*-e.anchorY+"%)"),r&&(t+="transform:"+r+";"),t},e.prototype.getStyleOut=function(e,t){switch(e){case"alpha":return"opacity:"+t+";";case"color":return"color:"+_.colorFromInt(t)+";";case"zIndex":return"z-index:"+t+";";default:return""}},e.prototype.animationTemplate=function(){for(var e="",t=0;t<this.defs.length;t++)for(var r=this.dm.def2set[this.defs[t].name],a=0;a<r.length;a++)if(this.defs[t].attrs.parent){var n=this.findParent(this.defs[t].attrs.parent);n&&(this.defSize(n),e+=this.keyframesTemplate(this.defs[t],r[a].name,r[a].valueStart,r[a].valueEnd,n.attrs.width/100,n.attrs.height/100))}else e+=this.keyframesTemplate(this.defs[t],r[a].name,r[a].valueStart,r[a].valueEnd);return"<style>"+e+"</style>"},e.prototype.keyframesTemplate=function(t,e,r,a,n,s){void 0===n&&(n=this.xProportion),void 0===s&&(s=this.yProportion);var i="",o="";if(r&&(void 0!==r.x||void 0!==r.y||void 0!==r.rotateX||void 0!==r.rotateY||void 0!==r.rotateZ||void 0!==r.scale)||a&&(void 0!==a.x||void 0!==a.y||void 0!==a.rotateX||void 0!==a.rotateY||void 0!==a.rotateZ||void 0!==a.scale)){var l=function(e){return a&&void 0!==a[e]?a[e]:r&&void 0!==r[e]?r[e]:t.attrs[e]?t.attrs[e]:0},u=l("x")*n,p=l("y")*s,h=l("rotateX"),c=l("rotateY"),f=l("rotateZ"),d="DefPath"===t.type?1:l("scale"),b=function(e){return r&&void 0!==r[e]?r[e]:void 0!==t.attrs[e]?t.attrs[e]:0},m=b("x")*n,v=b("y")*s,_=b("rotateX"),g=b("rotateY"),y=b("rotateZ"),k="DefPath"===t.type?1:b("scale");switch(t.type){case"DefText":i+="transform:translate("+m+"px, "+v+"px) rotateX("+_+"deg) rotateY("+g+"deg) rotateZ("+y+"deg) scale("+k+");",o+="transform:translate("+u+"px, "+p+"px) rotateX("+h+"deg) rotateY("+c+"deg) rotateZ("+f+"deg) scale("+d+");";break;case"DefButton":case"DefPath":i+="transform:translate("+m+"px, "+v+"px);",o+="transform:translate("+u+"px, "+p+"px);"}}for(var w in r)r.hasOwnProperty(w)&&(i+=this.getStyleOut(w,r[w]));for(var w in a)a.hasOwnProperty(w)&&(o+=this.getStyleOut(w,a[w]));return o||(o="line-height:1;"),i?"\n@-webkit-keyframes "+e+" {\n    0% { "+i+" }\n    100% { "+o+" }\n}\n@keyframes "+e+" {\n    0% { "+i+" }\n    100% { "+o+" }\n}":"\n@-webkit-keyframes "+e+" {\n    100% { "+o+" }\n}\n@keyframes "+e+" {\n    100% { "+o+" }\n}"},e.prototype.prefixCSS=function(e,t){for(var r="",a=0;a<this.prefix.length;a++)r+=""+this.prefix[a]+e+":"+t+";";return r},e.prototype.bindEvents=function(t){var r=this;t.addEventListener("animationend",function(e){return r.animationCallback(e)}),t.addEventListener("webkitAnimationEnd",function(e){return r.animationCallback(e)});for(var e=function(e){a.defs[e].attrs.target&&t.getElementsByClassName("bas-danmaku-item--"+a.defs[e].name)[0].addEventListener("click",function(){"av"===r.defs[e].attrs.target.objType?(window.open("//www.bilibili.com/video/av"+r.defs[e].attrs.target.av+"/index_"+r.defs[e].attrs.target.page+".html"+(r.defs[e].attrs.target.time?"?t="+r.defs[e].attrs.target.time/1e3:"")),r.player&&r.player.pause()):"bangumi"===r.defs[e].attrs.target.objType?(window.open("//www.bilibili.com/bangumi/play/ss"+r.defs[e].attrs.target.seasonId+(r.defs[e].attrs.target.time?"?t="+r.defs[e].attrs.target.time/1e3:"")+"#"+r.defs[e].attrs.target.episodeId),r.player&&r.player.pause()):"seek"===r.defs[e].attrs.target.objType&&r.player&&r.player.seek(r.defs[e].attrs.target.time/1e3)})},a=this,n=0;n<this.defs.length;n++)e(n)},e.prototype.destroy=function(){},e}(),d=function(e,t){var r={};for(var a in e)e.hasOwnProperty(a)&&(r[a]=e[a]);for(var a in t)t.hasOwnProperty(a)&&(r[a]=t[a]);return r},b=function(e,t,r){return r||(e=e.replace(/&/g,"").replace(/</g,"").replace(/>/g,"").replace(/"/g,"").replace(/'/g,"").replace(/\//g,"").replace(/:/g,"").replace(/;/g,"")),e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2f;").replace(/ /g,t?" ":"&nbsp;").replace(/\n/g,"<br>")},a=function(){function e(){this.class_names=["text","button","path"],this._variable_table={},this._varibale_reg_order=0,this._template_table={},this.tpl_name_id=0,this.obj_name_id=0,
this._allows_variable=[]}return e.prototype.on_String_value=function(e){for(var t=[],r=0,a=e;r<a.length;r++){var n=a[r];switch(n.type){case"char":var s=null;switch(n.value.charAt(1)){case"n":s="\n";break;case"r":s="\r";break;case"t":s="\t";break;case"\\":s="\\";break;case"'":s="'";break;case'"':s='"';break;default:s=n.charAt(1)}t.push(s);break;case"unicode":case"ascii":var i=n.value.substr(2);t.push(String.fromCharCode(parseInt(i,16)));break;case"seg":t.push(n.value)}}return new o({type:"String",value:t.join("")})},e.prototype.on_Num_value=function(e,t,r){return t=t,new o({type:"Num",value:{numType:(r="%"==r)?"percent":"number",value:(e="+"==e?1:-1)*parseFloat(t)}})},e.prototype.on_Time_value=function(e){for(var t=!0,r=0,a=0,n="",s=null;null!=(s=t?e.match(/^(\d*\.?\d+(?:[eE][\+\-]?\d+)?)(.*)$/):e.match(/^([hms]+)(.*)$/));){if(n=s[1],t)a=parseFloat(n);else switch(n){case"h":r+=3600*a*1e3;break;case"m":r+=60*a*1e3;break;case"s":r+=1e3*a;break;case"ms":r+=a}e=s[2],t=!t}return new o({type:"Time",value:r})},e.prototype.on_Hex_value=function(e){return new o({type:"Hex",value:parseInt(e.substr(2),16)})},e.prototype.on_Object_value=function(e,t){return new o({type:"Object",value:t})},e.prototype.on_Array_value=function(e){return new o({type:"Array",value:e})},e.prototype.on_Variable_value=function(e){return new o({type:"Variable",value:e})},e.prototype.on_KeyValue_list=function(e,t,r){return void 0===r&&(r=null),null==r&&(r=this.peek_allows_varable()),t},e.prototype.on_let_object_binding=function(e,t){t.obj_type;var r=t.name;return this.unregister_variable(r),t.name=e,this.register_variable(e,t),t},e.prototype.on_def_object=function(e,t,r){var a={type:"Def"+this.capitalization_str(e),obj_type:e,name:t,attrs:{}},n=this.on_KeyValue_list(e,r,!1);return this.fill_kv_obj(a.attrs,n),this.register_variable(t,a),a},e.prototype.on_def_template=function(e,t,r,a){var n={type:"template",obj_type:e,name:t,attrs:{},tpl_list:[]},s=this.on_KeyValue_list(e,a,!0);return this.check_variables_on_template_body(r,s),this.fill_kv_obj(n.attrs,a),n.tpl_list=r,this.register_template(t,n),n},e.prototype.on_object_modification=function(e,t){if(!this.has_variable_obj(e)){if(-1==this.class_names.indexOf(e))return null;var r=this.new_variable_name_of_template_application(e);return this.on_def_object(e,r,t)}var a=this.get_variable_obj(e),n=a.obj_type,s=this.new_variable_name_of_variable_modification(e),i={type:"Def"+this.capitalization_str(n),obj_type:n,name:s,attrs:{}},o=this.on_KeyValue_list(n,t,!1),l=this.merge_list(a.attrs,o);return this.fill_kv_obj(i.attrs,l),this.register_variable(s,i),i},e.prototype.on_tmp_object_modification=function(e,t){var r=e.name,a=this.on_object_modification(r,t);return this.unregister_variable(r),a},e.prototype.on_template_application=function(e,t){var r=this.get_template_obj(e);if(null==r)return null;var a=r.obj_type,n=this.new_variable_name_of_template_application(e),s={type:"Def"+this.capitalization_str(a),obj_type:a,name:n,attrs:{}},i=this.evaluation_template(r.attrs,r.tpl_list,t);return this.fill_kv_obj(s.attrs,i),this.register_variable(n,s),s},e.prototype.on_ArgList=function(e){for(var t=[],r=[],a=0,n=e;a<n.length;a++){var s=n[a],i=s[0],o=s[1];null==i?t.push(o):r.push([i,o])}return{naked_params:t,named_params:r}},e.prototype.on_unit_set_expr=function(e,t,r){var a={type:"Unit",duration:r[0],default_easing:r[1],target_name:e,attrs:{}},n=this.get_variable_type(e),s=this.on_KeyValue_list(n,t,!1);return this.fill_kv_obj(a.attrs,s),a},e.prototype.on_temporary_target_set_expr=function(e,t,r){var a=e.obj_type,n=e.name,s={type:"Unit",duration:r[0],default_easing:r[1],target_name:n,attrs:{}},i=this.on_KeyValue_list(a,t,!1);return this.fill_kv_obj(s.attrs,i),s},e.prototype.on_then_set_expr=function(e,t){return"Serial"==e.type?(e.items.push(t),e):{type:"Serial",items:[e,t]}},e.prototype.on_group_set_expr=function(e){return{type:"Parallel",items:e}},e.prototype.has_variable_obj=function(e){return this._variable_table.hasOwnProperty(e)},e.prototype.get_variable_obj=function(e){return this._variable_table.hasOwnProperty(e
)?this._variable_table[e]:(console.error("var "+e+" is not defined."),null)},e.prototype.get_template_obj=function(e){return this._template_table.hasOwnProperty(e)?this._template_table[e]:(console.error("tpl "+e+" is not defined."),null)},e.prototype.get_variable_type=function(e){return this.get_variable_obj(e).obj_type},e.prototype.get_template_type=function(e){return this.get_template_obj(e).obj_type},e.prototype.fill_kv_obj=function(e,t){for(var r=0,a=t;r<a.length;r++){var n=a[r],s=n[0],i=n[1];e[s]=i}},e.prototype.merge_list=function(e,t){var r={};this.fill_kv_obj(r,t);var a=[];for(var n in e)r.hasOwnProperty(n)?a.push([n,r[n]]):a.push([n,e[n]]);for(var s=0,i=t;s<i.length;s++){var o=i[s],l=(n=o[0],o[1]);e.hasOwnProperty(n)||a.push([n,l])}return a},e.prototype.evaluation_template=function(e,t,r){for(var a=r.naked_params,n=r.named_params,s={},i=t.map(function(e,t){var r=e[0];e[1];return s[r]=t,{key:r,matched:!1}}),o={},l=0,u=n;l<u.length;l++){var p=u[l],h=p[0],c=p[1];o[h]=c,s.hasOwnProperty(h)?i[s[h]].matched=!0:console.error("看看命名参数是不是没有在定义参数里面..")}var f=i.filter(function(e){return!e.matched});f.length<a.length&&console.error("参数太多了..");for(var d=0;d<a.length&&d<f.length;d++){o[h=f[d].key]=a[d]}for(var b={},m=0,v=t;m<v.length;m++){var _=v[m];h=_[0],c=_[1];o.hasOwnProperty(h)?b[h]=o[h]:b[h]=c}var g=[];for(var h in e){var y=e[h];if("Variable"==y.type){var k=y.value;b.hasOwnProperty(k)?g.push([h,b[k]]):console.error("eval template err: no variable named "+k+" is provided.")}else g.push([h,y])}return g},e.prototype.capitalization_str=function(e){return e.substr(0,1).toUpperCase()+e.substr(1)},e.prototype.new_variable_name_of_template_application=function(e){var t="tpl_"+e+"_"+this.tpl_name_id;return this.tpl_name_id+=1,t},e.prototype.new_variable_name_of_variable_modification=function(e){var t="obj_"+e+"_"+this.obj_name_id;return this.obj_name_id+=1,t},e.prototype.register_variable=function(e,t){this._variable_table.hasOwnProperty(e)&&console.log("var "+e+" is already exists, and will be shadowed."),t._reg_order=this._varibale_reg_order,this._variable_table[e]=t,this._varibale_reg_order+=1},e.prototype.unregister_variable=function(e){delete this._variable_table[e]},e.prototype.register_template=function(e,t){this._template_table.hasOwnProperty(e)&&console.log("tpl "+e+" is already exists, and will be shadowed."),this._template_table[e]=t},e.prototype.on_enter_scope=function(){},e.prototype.on_leave_scope=function(){},e.prototype.on_enter_tpl=function(){this._allows_variable.push(!0)},e.prototype.on_leave_tpl=function(){this._allows_variable.pop()},e.prototype.peek_allows_varable=function(){return 0<this._allows_variable.length&&this._allows_variable[this._allows_variable.length-1]},e.prototype.check_variables_on_template_body=function(e,t){var r={};this.fill_kv_obj(r,t);for(var a=0,n=e;a<n.length;a++){var s=n[a],i=(s[0],s[1]);if("Variable"==i.type){var o=i.value;r.hasOwnProperty(o)||console.error("varibale "+o+" in template's body is not present at arguments.")}}},e.prototype.on_Result=function(e){var t=[];for(var r in this._variable_table)t.push(this._variable_table[r]);return t.sort(function(e,t){return e.obj_name_id-t.obj_name_id}),{sets:e.filter(function(e){return"SetExpr"==e.type}).map(function(e){return e.params}),defs:t}},e}(),o=function(){function e(e){this.type=e.type,this.value=e.value}return e.prototype.as_string=function(){if("String"==this.type)return this.value},e.prototype.as_integer=function(){return"Hex"==this.type?this.value:"Num"==this.type?Math.floor(this.value.value):void 0},e.prototype.as_number=function(){if("Num"==this.type)return this.value},e.prototype.as_time=function(){if("Time"==this.type)return this.value},e.prototype.as_object=function(){if("Object"==this.type)return this.value},e}(),u=4294967295,p=4294967295,n=function(){function n(){this.transTable=[[!1,[4294967295,2,1],[[0,42,0],[43,43,1],[44,44,2]]],[!1,[4294967295,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3],[[0,2,0],[3,3,1],[4,4,2],[5,5,3],[6,6,4],[7,7,5],[8,8,6],[9,9,7],[10,10,8],[11,11,9],[12,12,10],[13,13,11],
[14,14,12],[15,15,13],[16,16,14],[17,17,15],[18,18,16],[19,19,17],[20,20,18],[21,21,19],[22,22,20],[23,37,21],[38,38,22],[39,39,23],[40,41,24],[42,42,25],[43,44,0]]],[!1,[30,28,29,4294967295],[[0,0,0],[1,20,1],[21,21,2],[22,39,1],[40,40,3],[41,42,1],[43,44,3]]],[!1,[4294967295,31],[[0,41,0],[42,42,1],[43,44,0]]],[!1,[4294967295,4],[[0,39,0],[40,41,1],[42,44,0]]],[!1,[4294967295,14,37,36,35,34,33,32],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,31,0],[32,32,3],[33,34,4],[35,35,5],[36,37,6],[38,38,7],[39,39,1],[40,44,0]]],[!1,[4294967295,38],[[0,15,0],[16,16,1],[17,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!0],[!0],[!0],[!0],[!1,[4294967295,7,39],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,35,1],[36,36,2],[37,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,40],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,35,1],[36,36,2],[37,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,14,37,36,34,33,32],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,31,0],[32,32,3],[33,34,0],[35,35,4],[36,37,5],[38,38,6],[39,39,1],[40,44,0]]],[!1,[4294967295,7,41],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,31,1],[32,32,2],[33,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,42],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,35,1],[36,36,2],[37,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!0],[!0],[!0],[!0],[!0],[!1,[4294967295,7,43],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,30,1],[31,31,2],[32,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,44],[[0,6,0],[7,8,1],[9,13,0],[14,16,1],[17,17,2],[18,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!0],[!0],[!0],[!0],[!0],[!0],[!1,[45,4294967295,47,46],[[0,0,0],[1,1,1],[2,2,0],[3,14,1],[15,15,0],[16,20,1],[21,21,0],[22,27,1],[28,28,2],[29,30,0],[31,33,1],[34,34,3],[35,44,1]]],[!1,[31,48,4294967295],[[0,39,0],[40,40,1],[41,42,0],[43,44,2]]],[!1,[4294967295,38],[[0,15,0],[16,16,1],[17,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,49,50],[[0,15,0],[16,16,1],[17,19,0],[20,20,2],[21,21,0],[22,22,2],[23,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,51,53,52],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,37,0],[38,38,3],[39,39,1],[40,44,0]]],[!1,[4294967295,54],[[0,6,0],[7,8,1],[9,13,0],[14,14,1],[15,15,0],[16,16,1],[17,25,0],[26,27,1],[28,35,0],[36,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,55,56],[[0,15,0],[16,16,1],[17,37,0],[38,38,2],[39,39,1],[40,44,0]]],[!1,[4294967295,57,58],[[0,15,0],[16,16,1],[17,37,0],[38,38,2],[39,39,1],[40,44,0]]],[!1,[4294967295,38,37,36,34,33],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,31,0],[32,32,3],[33,34,0],[35,35,4],[36,37,5],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,59],[[0,6,0],[7,8,1],[9,13,0],[14,14,1],[15,15,2],[16,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,60],[[0,6,0],[7,8,1],[9,13,0],[14,14,1],[15,15,2],[16,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,61],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,35,1],[36,36,2],[37,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,62],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,26,1],[27,27,2],[28,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,63],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,30,1],[31,31,2],[32,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,64],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,24,1],[25,25,2],[26,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!0],[!1,[4294967295,65],[[0,6,0],[7,8,1],[9,13,0],[14,14,1],[15,15,0],[16,16,1],[17,25,0],[26,27,1],[28,35,0],[36,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,66],[[0,6,0],[7,8,1],[9,13,0],[14,14,1],[15,15,0],[16,16,1],[17,25,0],[26,27,1],[28,35,0],[36,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,48],[[0,39,0],[40,40,1],[41,44,0]]],[!1,[4294967295,49,37,36,34],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,31,0],[32,32,3],[33,34,0],[35,35,4],[36,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,49],[[0,15,0],[16,16,1],[17,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,51,37,68,67,52],[[0,15,0],[16,16,1
],[17,17,0],[18,18,2],[19,34,0],[35,35,3],[36,37,4],[38,38,5],[39,39,1],[40,44,0]]],[!1,[4294967295,69],[[0,15,0],[16,16,1],[17,38,0],[39,39,1],[40,44,0]]],[!0],[!1,[4294967295,54],[[0,6,0],[7,8,1],[9,13,0],[14,14,1],[15,15,0],[16,16,1],[17,25,0],[26,27,1],[28,35,0],[36,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,55,37,34,70,56],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,34,0],[35,35,3],[36,37,4],[38,38,5],[39,39,1],[40,44,0]]],[!1,[4294967295,71],[[0,15,0],[16,16,1],[17,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,57,68,72,58],[[0,15,0],[16,16,1],[17,34,0],[35,35,2],[36,37,3],[38,38,4],[39,39,1],[40,44,0]]],[!1,[4294967295,73],[[0,15,0],[16,16,1],[17,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,74],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,29,1],[30,30,2],[31,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,75],[[0,6,0],[7,8,1],[9,13,0],[14,16,1],[17,17,2],[18,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,76],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,29,1],[30,30,2],[31,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,77],[[0,6,0],[7,8,1],[9,13,0],[14,14,1],[15,15,0],[16,16,1],[17,25,0],[26,27,1],[28,35,0],[36,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,78],[[0,6,0],[7,8,1],[9,13,0],[14,14,1],[15,15,0],[16,16,1],[17,25,0],[26,27,1],[28,35,0],[36,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,79,80],[[0,15,0],[16,16,1],[17,19,0],[20,20,2],[21,21,0],[22,22,2],[23,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,53],[[0,17,0],[18,18,1],[19,44,0]]],[!1,[4294967295,69,37,68,67],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,34,0],[35,35,3],[36,37,4],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,81,82],[[0,15,0],[16,16,1],[17,19,0],[20,20,2],[21,21,0],[22,22,2],[23,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,71,37,34,70],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,34,0],[35,35,3],[36,37,4],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,83,84],[[0,15,0],[16,16,1],[17,19,0],[20,20,2],[21,21,0],[22,22,2],[23,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,73,68,72],[[0,15,0],[16,16,1],[17,34,0],[35,35,2],[36,37,3],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,85],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,23,1],[24,24,2],[25,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7,86],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,35,1],[36,36,2],[37,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!0],[!1,[4294967295,87],[[0,6,0],[7,8,1],[9,13,0],[14,14,1],[15,15,0],[16,16,1],[17,25,0],[26,27,1],[28,35,0],[36,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,79,37,68],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,34,0],[35,35,3],[36,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,79],[[0,15,0],[16,16,1],[17,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,81,37,34],[[0,15,0],[16,16,1],[17,17,0],[18,18,2],[19,34,0],[35,35,3],[36,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,81],[[0,15,0],[16,16,1],[17,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,83,68],[[0,15,0],[16,16,1],[17,34,0],[35,35,2],[36,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,83],[[0,15,0],[16,16,1],[17,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,7],[[0,6,0],[7,8,1],[9,13,0],[14,18,1],[19,22,0],[23,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!1,[4294967295,88],[[0,6,0],[7,8,1],[9,13,0],[14,14,1],[15,15,0],[16,16,1],[17,25,0],[26,27,1],[28,35,0],[36,37,1],[38,38,0],[39,39,1],[40,44,0]]],[!0]],this.finalTable={4:1,5:3,6:26,7:30,8:5,9:7,10:6,11:27,12:30,13:30,14:3,15:30,16:30,17:19,18:22,19:23,20:29,21:20,22:30,23:30,24:24,25:28,26:21,27:25,28:12,29:11,31:0,34:2,36:2,37:2,38:3,
39:30,40:30,41:30,42:30,43:30,44:30,45:8,48:0,49:3,53:2,54:4,59:13,60:14,61:30,62:15,63:30,64:30,74:18,75:30,76:30,77:10,85:16,86:17,88:9},this.inputTable=[[0,8,1],[9,9,41],[10,10,40],[11,11,1],[12,12,41],[13,13,40],[14,31,1],[32,32,41],[33,33,1],[34,34,21],[35,35,1],[36,36,23],[37,37,10],[38,38,1],[39,39,2],[40,40,9],[41,41,4],[42,42,1],[43,43,22],[44,44,19],[45,45,20],[46,46,38],[47,47,42],[48,48,39],[49,57,16],[58,58,1],[59,59,5],[60,60,1],[61,61,13],[62,63,1],[64,64,23],[65,68,26],[69,69,37],[70,70,26],[71,87,23],[88,88,33],[89,90,23],[91,91,12],[92,92,0],[93,93,11],[94,94,1],[95,95,23],[96,96,1],[97,97,8],[98,98,26],[99,99,7],[100,100,14],[101,101,36],[102,102,27],[103,103,23],[104,104,32],[105,107,23],[108,108,17],[109,109,35],[110,110,30],[111,111,25],[112,112,31],[113,113,23],[114,114,29],[115,115,18],[116,116,15],[117,117,28],[118,119,23],[120,120,34],[121,121,24],[122,122,23],[123,123,6],[124,124,1],[125,125,3],[126,65535,1]],this.initialTable={STRING:1,INITIAL:2}}return n.lexSeq=function(e){var t=new n;t.source=e;for(var r=[],a=t.token;"<$>"!==a;)r.push({token:a,text:t.yytext,start:t.startIdx,end:t.endIdx}),t.advance(),a=t.token;return r},n.prototype.yyrestart=function(e){void 0===e&&(e=null),null!=e&&(this.sourceString=e),this.ended=!1,this.start=0,this.oldStart=0,this.line=1,this.col=0,this.advanced=!0,this.tokenNameString=null,this.yyObject={},this.initialState="INITIAL"},Object.defineProperty(n.prototype,"source",{set:function(e){this.sourceString=e,this.yyrestart()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"token",{get:function(){return this.advanced&&(this.tokenNameString=this.next(),this.advanced=!1),this.tokenNameString},enumerable:!0,configurable:!0}),n.prototype.advance=function(){this.advanced=!0},Object.defineProperty(n.prototype,"startIdx",{get:function(){return this.oldStart},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"endIdx",{get:function(){return this.start},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"position",{get:function(){return[this.line,this.col]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positionInfo",{get:function(){return this.token+"@row:"+this.position.join("col:")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"yytext",{get:function(){return this.yyText},set:function(e){this.yyText=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"yyleng",{get:function(){return this.endIdx-this.startIdx},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"yy",{get:function(){return this.yyObject},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"tokenName",{get:function(){return this.tokenNameString},enumerable:!0,configurable:!0}),n.prototype.next=function(){for(var e,t,r,a,n,s,i,o,l;;)for(t=e=null,r=0,a=this.start,n=this.start,s=p,o=u,l=this.start,i=this.transTable[0][1][this.initialInput];;){if(r=this.sourceString.charCodeAt(n),s!==p&&(13===r?(this.col=0,this.line++):10===r?13!==s&&(this.col=0,this.line++):this.col++),s=r,(t=this.trans(i,r))===u){if(a===l){if(this.start!==this.sourceString.length)throw new Error("意外的字符,line:"+this.position.join(",col:")+"of "+this.sourceString.substr(a,20));if(!1===this.ended)return this.ended=!0,"<$>";throw new Error("已经到达末尾.")}switch(e=this.finalTable[o],this.start=l,this.oldStart=a,this.yyText=this.sourceString.substring(this.startIdx,this.endIdx),e){case 2:return"time";case 3:return"number";case 4:return"hex";case 5:return"+";case 6:return"-";case 7:return this.begin("STRING"),"str_start";case 8:return"str_esc_char";case 9:return"str_esc_unicode";case 10:return"str_esc_ascii";case 11:return this.begin("INITIAL"),"str_end";case 12:return"str_seg";case 13:return"set";case 14:return"let";case 15:return"def";case 16:return"apply";case 17:return"clone";case 18:return"then";case 19:return"=";case 20:return"(";case 21:return")";case 22:return"[";case 23:return"]";case 24:return"{";case 25:return"}";case 26:return".";case 27:return",";case 28:return";";case 29:return"%";case 30:return"id"}break}
null!=(e=this.finalTable[t])&&(o=t,l=n+1),n+=1,i=t}},n.prototype.trans=function(e,t){if(isNaN(t))return u;if(t<this.inputTable[0][0]||t>this.inputTable[this.inputTable.length-1][1])throw new Error("输入超出有效范围,line:"+this.position.join(",col:"));if(!0===this.transTable[e][0])return u;var r=this.find(t,this.inputTable),a=this.find(r,this.transTable[e][2]);return this.transTable[e][1][a]},n.prototype.find=function(e,t){var r,a,n;for(r=0,a=t.length-1;;){if(t[n=r+a>>>1][0]<=e&&t[n][1]>=e)return t[n][2];t[n][0]>e?a=n-1:r=n+1}},n.prototype.begin=function(e){void 0===e&&(e=null),this.initialState=null!=e?e:"INITIAL"},Object.defineProperty(n.prototype,"initialState",{get:function(){return this.initialStateString},set:function(e){if(void 0===this.initialTable[e])throw new Error("未定义的起始状态:"+e);this.initialStateString=e,this.initialInput=this.initialTable[e]},enumerable:!0,configurable:!0}),n}(),m=function(){function r(){this.ast_helper=new a,this.actionTable=[null,{0:6,1:1,2:2,67:54,68:36,69:20,70:16,8:4,9:8,10:10,76:12,77:32,78:50,73:148,74:44,85:52,89:14,90:150,29:18,101:120,41:150,43:36,47:104,112:40,115:34,116:38,120:56,124:150,125:42},{0:6,2:9,67:54,4:22,69:20,70:16,8:4,9:8,10:10,76:12,77:32,14:9,73:148,18:9,85:52,78:50,24:28,25:9,90:150,74:44,29:18,68:36,89:14,36:26,101:120,41:150,43:36,47:104,112:40,115:34,116:38,120:56,124:150,125:42},{3:25,5:33,6:35,7:37,12:43,16:57,19:68,21:43,23:68,26:68,28:43,30:87,31:68,32:95,35:87,38:87,39:68,40:68,44:66,45:87,47:104,48:106,53:102,54:98,61:96,62:100,64:132,65:134,66:68,71:87,72:87,75:187,79:68,80:201,82:140,86:95,87:112,88:87,92:64,93:94,94:70,95:90,96:92,98:87,101:120,106:239,107:138,109:110,110:108,113:46,114:72,117:136,121:68,122:87},{0:6,2:11,67:54,4:22,69:20,70:16,8:4,9:8,10:10,11:41,68:36,13:49,14:11,73:148,18:11,20:65,77:32,78:50,124:150,24:28,25:11,90:150,27:81,92:161,29:18,33:135,34:30,91:229,36:26,74:44,85:52,76:12,41:150,89:14,43:36,101:120,46:161,47:104,112:40,115:34,99:161,120:56,116:38,125:42},{19:68,23:68,24:28,25:24,29:18,30:89,31:68,35:139,36:26,37:141,39:68,43:36,44:66,45:159,47:104,48:106,53:102,54:98,61:96,62:100,64:132,65:134,66:68,68:36,69:20,70:16,71:183,76:12,77:32,79:68,82:140,87:112,88:225,89:14,92:64,93:94,94:70,95:90,96:92,98:237,101:120,107:138,109:110,110:108,113:46,114:72,115:34,116:38,117:136,121:68,122:48,123:251},{0:6,2:13,67:54,4:22,69:20,70:16,8:4,9:8,10:10,76:12,77:32,14:13,73:148,18:13,85:52,78:50,24:28,25:13,90:150,74:44,29:18,68:36,89:14,36:26,101:120,41:150,43:36,47:104,112:40,115:34,116:38,120:56,124:150,125:42},{3:27,20:67,21:45,27:83,12:45,28:45,15:55},{64:132,65:134,67:54,94:70,117:136,72:185,120:56,111:243,78:50,82:140,85:52,22:71,87:112,26:68,92:64,93:94,86:80,95:90,32:80,33:137,100:84,101:120,38:143,40:68,107:138,44:66,109:110,110:108,47:104,48:106,96:92,114:72,108:76,53:102,54:98,55:173,56:74,57:78,58:82,59:86,60:88,61:96,62:100},{36:39,69:20,70:16,10:39,43:36,76:12,77:32,47:104,115:34,116:38,68:36,101:120,24:39,89:14,29:18},{64:132,65:134,117:136,118:144,77:197,82:140,83:146,84:215,87:112,92:64,93:94,94:231,95:90,96:92,100:84,101:120,107:138,109:110,110:108,47:104,48:106,53:102,54:98,119:142,57:175,58:82,59:86,60:88,61:96,62:100},{0:6,2:15,67:54,68:36,69:20,70:16,8:4,9:8,10:10,76:12,77:32,78:50,73:148,74:44,85:52,89:14,90:150,29:18,101:120,41:150,43:36,47:104,112:40,115:34,116:38,120:56,124:150,125:42},{0:6,2:17,67:54,68:36,69:20,70:16,8:4,9:8,10:10,76:12,77:32,78:50,73:148,74:44,85:52,89:14,90:150,29:18,101:120,41:150,43:36,47:104,112:40,115:34,116:38,120:56,124:150,125:42},{17:59,42:153,46:163},{32:97,75:97,52:97,86:97,80:97,106:97,43:97,68:97},{32:99,80:99,106:99,75:99,52:99,86:99},{32:118,49:114,50:116,52:118,86:118,80:118,106:118,75:118,63:177},{87:221},{32:101,80:101,106:101,75:101,52:101,86:101},{32:103,80:103,106:103,75:103,52:103,86:103},{32:105,97:105,52:105,86:105,80:105,106:105,75:105},{104:126,81:205,105:128,51:130,102:122,103:124},{104:126,81:207,105:128,51:130,102:122,103:124},{104:126,81:209,105:128,51:130,102:122,103:124},{104:126,81:211,105:128,51:130,102:122,103:124},{104:126,81:213,105:128,51:130,102:122,103:124},{
32:107,80:107,75:107,86:107},{101:120,118:144,109:110,110:108,47:104,48:106,83:146,52:167,53:102,54:98,87:112,84:217,61:96,62:100,119:142},{67:54,85:52,120:56,41:149,90:149,124:149,78:50}],this.gotoTable={64:{52:171},29:{0:5},30:{0:7},31:{2:19},32:{2:21},33:{25:75,18:61,2:23,14:51},34:{79:199,23:73,19:63,39:145,40:147,121:247,26:79,66:179,31:93},35:{68:181,43:155},36:{3:29},37:{4:31},38:{14:53},39:{25:77},40:{12:47,21:69,28:85},41:{32:109,75:109,52:109,86:109,80:109,106:109,43:157,68:157},42:{97:233},43:{32:111,97:235,52:111,86:111,80:111,106:111,75:111},44:{124:253,41:151,90:227},45:{113:245},46:{122:249},47:{32:113},49:{75:189},50:{88:91,98:91,35:91,38:91,71:91,72:91,122:91,45:91,30:91},51:{75:191},52:{32:115,86:219},53:{32:117,86:117},54:{32:119,80:203,86:119},55:{32:121,80:121,106:241,75:193,52:169,86:121},56:{32:123,80:123,75:195,86:123},57:{32:125,80:125,106:125,75:125,52:125,86:125},58:{32:127,80:127,106:127,75:127,52:127,86:127},59:{32:129,80:129,106:129,75:129,52:129,86:129},60:{87:223},61:{51:165},62:{32:131,80:131,75:131,86:131},63:{32:133,80:133,75:133,86:133}},this.prodList=[[65,2],[29,1],[30,2],[30,0],[31,1],[31,1],[33,6],[33,6],[33,5],[33,3],[33,5],[37,0],[39,0],[38,2],[38,1],[36,3],[35,1],[35,3],[35,0],[42,1],[32,7],[32,12],[32,5],[45,0],[46,0],[40,4],[40,4],[40,3],[40,6],[48,3],[48,1],[48,0],[49,1],[34,2],[34,0],[50,3],[50,4],[47,1],[52,3],[52,1],[52,0],[53,1],[53,3],[54,1],[54,1],[51,1],[51,1],[51,1],[55,1],[55,1],[55,1],[55,1],[41,1],[58,1],[57,3],[60,1],[60,0],[59,1],[59,1],[59,0],[43,3],[61,2],[61,2],[61,2],[61,2],[61,0],[56,1],[56,1],[63,4],[62,3],[62,2],[64,3],[64,3],[64,1],[44,1],[44,0]],this.inputTable={"<$>":1,set:2,id:3,"{":4,"}":5,apply:6,"(":7,")":8,then:9,",":10,def:11,let:12,"=":13,time:14,hex:15,number:16,"%":17,"+":18,"-":19,str_start:20,str_end:21,str_esc_char:22,str_esc_unicode:23,str_esc_ascii:24,str_seg:25,"[":26,"]":27,";":28}}return r.parse=function(e){var t=new n;return t.source=e,(new r).parseLexer(t)},r.prototype.parseLexer=function(e){for(var t,r,a,n=[0],s=[];;){if(r=e.token,t=n[n.length-1],null==this.actionTable[this.inputTable[r]][t])throw new Error("Parse Error:"+e.positionInfo);if(1===(a=this.actionTable[this.inputTable[r]][t]))return s.pop();if(1==(1&a))s.push(e.yytext),n.push((a>>>1)-1),e.advance();else if(0==(1&a)){var i=a>>>1,o=this.prodList[i][1],l=null;switch(0<o&&(l=s[s.length-o]),i){case 1:l=this.ast_helper.on_Result(s[s.length-1]);break;case 2:(l=s[s.length-2]).push(s[s.length-1]);break;case 3:l=[];break;case 4:break;case 5:l={type:"SetExpr",params:s[s.length-1]};break;case 6:l=this.ast_helper.on_unit_set_expr(s[s.length-5],s[s.length-3],s[s.length-1]);break;case 7:l=this.ast_helper.on_temporary_target_set_expr(s[s.length-5],s[s.length-3],s[s.length-1]);break;case 8:l={type:"ApplyExpr",params:[s[s.length-4],s[s.length-2]]};break;case 9:l=this.ast_helper.on_then_set_expr(s[s.length-3],s[s.length-1]);break;case 10:l=this.ast_helper.on_group_set_expr(s[s.length-3]);break;case 11:this.ast_helper.on_enter_scope();break;case 12:this.ast_helper.on_leave_scope();break;case 13:(l=s[s.length-2]).push(s[s.length-1]);break;case 14:l=[s[s.length-1]];break;case 15:l=s[s.length-2];break;case 16:l=[s[s.length-1]];break;case 17:l=[s[s.length-3],s[s.length-1]];break;case 18:l=[];break;case 19:break;case 20:l=this.ast_helper.on_def_object(s[s.length-6],s[s.length-5],s[s.length-3]);break;case 21:l=this.ast_helper.on_def_template(s[s.length-11],s[s.length-10],s[s.length-8],s[s.length-4]);break;case 22:l=this.ast_helper.on_let_object_binding(s[s.length-4],s[s.length-2]);break;case 23:this.ast_helper.on_enter_tpl();break;case 24:this.ast_helper.on_leave_tpl();break;case 25:l=this.ast_helper.on_object_modification(s[s.length-4],s[s.length-2]);break;case 26:l=this.ast_helper.on_template_application(s[s.length-4],s[s.length-2]);break;case 27:l=s[s.length-2];break;case 28:l=this.ast_helper.on_tmp_object_modification(s[s.length-5],s[s.length-3]);break;case 29:(l=s[s.length-3]).push(s[s.length-1]);break;case 30:l=[s[s.length-1]];break;case 31:l=[];break;case 32:
l=this.ast_helper.on_Variable_value(s[s.length-1]);break;case 33:(l=s[s.length-2]).push(s[s.length-1]);break;case 34:l=[];break;case 35:l=[s[s.length-3],s[s.length-1]];break;case 36:l=[s[s.length-4],s[s.length-2]];break;case 37:l=this.ast_helper.on_ArgList(s[s.length-1]);break;case 38:(l=s[s.length-1]).unshift(s[s.length-3]);break;case 39:l=[s[s.length-1]];break;case 40:l=[];break;case 41:l=[null,s[s.length-1]];break;case 42:l=[s[s.length-3],s[s.length-1]];break;case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:case 51:break;case 52:l=this.ast_helper.on_Time_value(s[s.length-1]);break;case 53:l=this.ast_helper.on_Hex_value(s[s.length-1]);break;case 54:l=this.ast_helper.on_Num_value(s[s.length-3],s[s.length-2],s[s.length-1]);break;case 55:case 56:case 57:case 58:break;case 59:l="+";break;case 60:l=this.ast_helper.on_String_value(s[s.length-2]);break;case 61:(l=s[s.length-2]).push({type:"char",value:s[s.length-1]});break;case 62:(l=s[s.length-2]).push({type:"unicode",value:s[s.length-1]});break;case 63:(l=s[s.length-2]).push({type:"ascii",value:s[s.length-1]});break;case 64:(l=s[s.length-2]).push({type:"seg",value:s[s.length-1]});break;case 65:l=[];break;case 66:case 67:break;case 68:l=this.ast_helper.on_Object_value(s[s.length-4],this.ast_helper.on_KeyValue_list(s[s.length-4],s[s.length-2]));break;case 69:l=this.ast_helper.on_Array_value(s[s.length-2]);break;case 70:l=this.ast_helper.on_Array_value([]);break;case 71:case 72:(l=s[s.length-3]).push(s[s.length-1]);break;case 73:l=[s[s.length-1]]}for(var u=0;u<o;)n.pop(),s.pop(),u++;if(t=n[n.length-1],null==this.gotoTable[this.prodList[i][0]][t])throw new Error("Goto Error!"+e.positionInfo);a=this.gotoTable[this.prodList[i][0]][t],n.push((a>>>1)-1),s.push(l)}}},r}();var s=function(e,t){void 0===t&&(t=!0);var r={x:{numType:"number",value:0},y:{numType:"number",value:0},zIndex:{numType:"number",value:0},scale:{numType:"number",value:1},duration:void 0},a={content:"请输入内容",alpha:{numType:"number",value:1},color:16777215,anchorX:{numType:"number",value:0},anchorY:{numType:"number",value:0},fontSize:{numType:"number",value:25},fontFamily:"SimHei",bold:{numType:"number",value:1},textShadow:{numType:"number",value:1},strokeWidth:{numType:"number",value:0},strokeColor:16777215,rotateX:{numType:"number",value:0},rotateY:{numType:"number",value:0},rotateZ:{numType:"number",value:0},parent:void 0},n={text:"请输入内容",fontSize:{numType:"number",value:25},textColor:0,textAlpha:{numType:"number",value:1},fillColor:16777215,fillAlpha:{numType:"number",value:1},target:void 0},s={d:void 0,viewBox:void 0,borderColor:0,borderAlpha:{numType:"number",value:1},borderWidth:{numType:"number",value:0},fillColor:16777215,fillAlpha:{numType:"number",value:1}};function i(e){for(var t in e)if(e.hasOwnProperty(t))switch(void 0!==e[t].value&&void 0!==e[t].value.numType&&void 0===e[t].easing?e[t]=e[t].value:void 0!==e[t].value&&void 0!==e[t].type&&(e[t]=e[t].value),t){case"content":e[t]=b(e[t],!1,!0);break;case"fontFamily":e[t]=b(e[t],!0,!1);break;case"parent":e[t]=b(e[t],!1,!1);break;case"text":e[t]=b(e[t],!1,!0);break;case"d":case"viewBox":e[t]=b(e[t],!0,!1);break;default:"string"==typeof e[t]&&(e[t]=b(e[t],!1,!1))}}function o(e){i(e.attrs),e.duration=e.duration.value,e.defaultEasing=e.default_easing&&e.default_easing.value,e.targetName=e.target_name}try{var l=m.parse(e),u={};u.defs=l.defs;for(var p=0;p<u.defs.length;p++){if(i(u.defs[p].attrs),u.defs[p].attrs.target){for(var h={objType:"seek"},c=0;c<u.defs[p].attrs.target.length;c++){var f=u.defs[p].attrs.target[c];"seasonId"===f[0]||"episodeId"===f[0]?h.objType="bangumi":"av"!==f[0]&&"page"!==f[0]||(h.objType="av"),f[1].value&&f[1].value.value?h[f[0]]=f[1].value.value:f[1].value&&(h[f[0]]=f[1].value)}u.defs[p].attrs.target=h}u.defs[p].attrs=d(r,l.defs[p].attrs),"DefText"===u.defs[p].type?u.defs[p].attrs=d(a,l.defs[p].attrs):"DefButton"===u.defs[p].type?u.defs[p].attrs=d(n,l.defs[p].attrs):"DefPath"===u.defs[p].type&&(u.defs[p].attrs=d(s,l.defs[p].attrs))}for(u.sets=l.sets,p=0;p<u.sets.length;p++)if(u.sets[p].items)for(
c=0;c<u.sets[p].items.length;c++)u.sets[p].items[c].attrs&&o(u.sets[p].items[c]);else o(u.sets[p]);return u}catch(e){throw new Error(e.message)}},l=r(0),h=r.n(l),c=function(){function e(e,t){void 0===e&&(e={}),this.paused=!0,this.sTime=0,this.dmList=[],this.cdmList=[],this.dmIndex=0,this.cTime=0,this.pTime=0,this.time0=0,this.pauseTime=0,this.testId=0,this.testDanmakus=[],this.worker=[],this.workerIndex=0,this.workerCount=2,this.inited=!1;var r={container:document.getElementById("player"),easing:"linear",visible:!0,fontFamily:"",timeSyncFunc:null};this.options=_.extend(r,e),this.player=t,this.container=this.options.container,this.paused=!0,this.sTime=0,this.inited=!1,this.dmList=[],this.cdmList=[],this.dmIndex=0,this.visibleStatus=this.options.visible,this.cTime=0,this.pTime=0,this.time0=0,this.pauseTime=0,this.startTime=(new Date).getTime(),this.testId=0;var a=_.browser.version;this.workerDisabled=a.safari&&!a.safariSupportMSE||!Worker||a.trident||a.edge||"chrome"===a.browser&&a.version<45}return e.prototype.init=function(){var e=this;if(!this.inited){var t;this.wrap=_.string2DOM('<div class="bas-danmaku '+(this.paused?"bas-danmaku-pause":"")+'"></div>'),this.container&&this.container.appendChild(this.wrap),this.inited=!0,this.resolutionWidth&&this.resolutionHeight&&this.resize(),window.requestAnimationFrame(function(){e.render()});var r=void 0,a=["webkit","moz","ms","o"];if("hidden"in document)t="hidden",r="visibilitychange";else for(var n=0;n<a.length;n++)a[n]+"Hidden"in document&&(t=a[n]+"Hidden",r=a[n]+"visibilitychange");document.addEventListener(r,function(){document[t]||"function"==typeof e.options.timeSyncFunc&&e.seek(e.options.timeSyncFunc()/1e3)})}},e.prototype.add=function(t){var r=this;if(t.dm instanceof Array){var a=0;t.dm.forEach(function(e){r.add({dm:e,parsed:t.parsed,test:t.test,noRefresh:!0,success:function(e){++a===t.dm.length&&(console.log("BAS added"),t.noRefresh||r.refresh())},error:function(){++a===t.dm.length&&(console.log("BAS added"),t.noRefresh||r.refresh())}})})}else{t.dm=$.extend({},t.dm);var n=function(e){r.inited||r.init(),t.test?(r.pretreatDanmaku(e,!0),r.testDanmakus.push(e),r.drawDanmaku(e)):(r.pretreatDanmaku(e),-1===e.stime&&(r.cTime?e.stime=r.cTime/1e3+.1:e.stime=r.options.timeSyncFunc()/1e3+.1),r.dmList.push(e),1!==r.dmList.length||r.paused||r.play(),t.noRefresh||r.refresh())};t.parsed?(n(t.dm),t.success&&t.success(t.dm)):this.parse({danmaku:t.dm,success:function(e){n(e),t.success&&t.success(e)},error:function(){t.error&&t.error()}})}},e.prototype.remove=function(t){this.dmList=this.dmList.filter(function(e){return e.dmid!==t}),this.refresh()},e.prototype.pretreatDanmaku=function(r,e){void 0===e&&(e=!1),e&&(r.dmid="test"+this.testId++,r.test=!0,r.stime=this.options.timeSyncFunc()/1e3),r.def2set={};for(var a=0;a<r.defs.length;a++){var t=r.defs[a].name,n=0;r.def2set[t]=[];for(var s=0;s<r.sets.length;s++)switch(r.sets[s].type){case"Serial":for(var i=0,o=0;o<r.sets[s].items.length;o++)r.sets[s].items[o].targetName===t&&(r.def2set[t].push({name:"bas-"+r.dmid+"-"+t+"-"+n,valueStart:this.getValueStart(o,n,r.def2set[t]),valueEnd:_.extend(this.getValueStart(o,n,r.def2set[t]),r.sets[s].items[o].attrs),easing:r.sets[s].items[o].defaultEasing||this.options.easing||"linear",duration:r.sets[s].items[o].duration/1e3,delay:i/1e3,group:s}),n++),i+=r.sets[s].items[o].duration;break;case"Parallel":for(o=0;o<r.sets[s].items.length;o++)r.sets[s].items[o].targetName===t&&(r.def2set[t].push({name:"bas-"+r.dmid+"-"+t+"-"+n,valueEnd:_.extend(this.getValueStart(o,n,r.def2set[t]),r.sets[s].items[o].attrs),easing:r.sets[s].items[o].defaultEasing||this.options.easing||"linear",duration:r.sets[s].items[o].duration/1e3,delay:0,group:s}),n++);break;case"Unit":r.sets[s].targetName===t&&(r.def2set[t].push({name:"bas-"+r.dmid+"-"+t+"-"+n,valueEnd:r.sets[s].attrs,easing:r.sets[s].defaultEasing||this.options.easing||"linear",duration:r.sets[s].duration/1e3,delay:0,group:s}),n++)}}var l=function(t){if({}.hasOwnProperty.call(r.def2set,t)){var e=r.defs.filter(function(e){return e.name===t})[0]
;e.attrs.duration?r.def2set[t].push({name:"bas-"+r.dmid+"-"+t+"-duration",valueEnd:{},easing:"linear",duration:e.attrs.duration/1e3,delay:0,group:-1}):0===r.def2set[t].length&&r.def2set[t].push({name:"bas-"+r.dmid+"-"+t+"-0",valueEnd:{},easing:"linear",duration:4,delay:0,group:-1})}};for(var u in r.def2set)l(u);for(var p in r.duration=0,r.def2set)if({}.hasOwnProperty.call(r.def2set,p)){r.setsIntervals={};var h=r.def2set[p].length;for(a=0;a<h;a++)if(r.def2set[p][a]){var c=[parseFloat(r.def2set[p][a].delay.toFixed(10)),parseFloat((r.def2set[p][a].delay+r.def2set[p][a].duration).toFixed(10)),r.def2set[p][a].group];for(var f in r.def2set[p][a].valueEnd)if(r.def2set[p][a].valueEnd.hasOwnProperty(f))if(-1!==["x","y","rotateX","rotateY","rotateZ","scale"].indexOf(f)&&(f="transform"),r.setsIntervals[f]){var d,b=r.setsIntervals[f].length,m=function(e){if(r.setsIntervals[f][e]){var t=r.setsIntervals[f][e][2];r.def2set[p][a].group!==t&&(r.setsIntervals[f][e][0]>c[0]&&r.setsIntervals[f][e][0]<c[1]||r.setsIntervals[f][e][1]>c[0]&&r.setsIntervals[f][e][1]<c[1]||r.setsIntervals[f][e][0]<=c[0]&&r.setsIntervals[f][e][1]>=c[1]&&r.setsIntervals[f][e][0]!==r.setsIntervals[f][e][1])&&c[0]!==c[1]&&(console.warn("BAS: attribute conflict, name: "+p+" attr: "+f+" time: "+c+" "+r.setsIntervals[f][e]),r.setsIntervals[f]=r.setsIntervals[f].filter(function(e){return e[2]!==t}),r.def2set[p]=r.def2set[p].filter(function(e){return e.group!==t}),e-=b-r.setsIntervals[f].length,b=r.setsIntervals[f].length,a-=h-r.def2set[p].length,h=r.def2set[p].length)}d=e};for(s=0;s<b;s++)m(s),s=d;r.setsIntervals[f].push(c)}else r.setsIntervals[f]=[c]}for(a=0;a<r.def2set[p].length;a++){var v=r.def2set[p][a].delay+r.def2set[p][a].duration;v>r.duration&&(r.duration=v)}}},e.prototype.getValueStart=function(e,t,r){return 1<=e&&1<=t?r[t-1].valueEnd&&Object.keys(r[t-1].valueEnd).length?r[t-1].valueEnd:this.getValueStart(e-1,t-1,r):null},e.prototype.parse=function(t){var e=t.danmaku;if(this.workerDisabled)try{var r=s(e.text);e.defs=r.defs,e.sets=r.sets,t.success&&t.success(e)}catch(e){console.warn("Error in BAS parser: ",e),t.error&&t.error(e.message)}else{if(!this.workerIndex)for(var a=0;a<this.workerCount;a++)this.worker[a]=new h.a;var n=this.worker[this.workerIndex%this.workerCount];n.onmessage=function(e){e.data.error?t.error&&t.error(e.data.error):(e.data.defs=e.data.defs,e.data.sets=e.data.sets,t.success&&t.success(e.data))},n.postMessage(e),this.workerIndex++}},e.prototype.render=function(){var e=this;this.paused||(window.requestAnimationFrame(function(){e.render()}),this.renderDanmaku())},e.prototype.renderDanmaku=function(){this.updateTime(),this.refreshCdmList(),this.drawDanmaku()},e.prototype.updateTime=function(){this.pTime=this.cTime;var e=(new Date).getTime();this.cTime=this.time0+e-this.startTime;if("function"==typeof this.options.timeSyncFunc){var t=this.options.timeSyncFunc();(1e3<Math.abs(t-this.cTime)||isNaN(this.cTime))&&(this.cTime=t,this.pTime=t,this.time0=t,this.startTime=e,this.refresh())}},e.prototype.refreshCdmList=function(e){if(this.visibleStatus){if(e)this.refresh();else if(this.cdmList=[],Math.abs(this.cTime-this.pTime)<500)for(var t=0;t<this.dmList.length;t++)this.dmList[t].stime>=this.pTime/1e3&&this.dmList[t].stime<this.cTime/1e3&&this.cdmList.push(this.dmList[t])}else this.clear()},e.prototype.drawDanmaku=function(e,t){var r=this;if(void 0===e&&(e=this.cdmList),void 0===t&&(t=0),this.visibleStatus)if(this.inited||this.init(),e instanceof Array)e.forEach(function(e){r.drawDanmaku(e)});else{var a=$.extend(!0,{},e),n=this,s=new i({container:this.wrap,dm:a,startTime:t,animationEndCallback:function(t){t.dm.test&&(n.testDanmakus=n.testDanmakus.filter(function(e){return e.dmid!==t.dm.dmid}))},player:this.player});this.options.blockJudge&&this.options.blockJudge(s.dm)?s.ele.style.visibility="hidden":s.ele.style.visibility="",s.ele&&this.wrap.appendChild(s.ele)}},e.prototype.play=function(){this.time0=this.pauseTime,this.startTime=(new Date).getTime(),this.pauseTime=0,this.paused=!1,this.wrap&&this.wrap.classList.remove("bas-danmaku-pause"),
this.dmList.length&&(this.inited||this.init(),this.render())},e.prototype.pause=function(){this.paused=!0,this.inited||this.init(),this.wrap.classList.add("bas-danmaku-pause");var e=(new Date).getTime();this.pauseTime=this.time0+e-this.startTime},e.prototype.toggle=function(){this.paused?this.play():this.pause()},e.prototype.seek=function(e,t){void 0===t&&(t=!0),this.testDanmakus=[],this.time0=1e3*e,this.startTime=(new Date).getTime(),this.inited||this.init(),this.dmList.length&&this.visibleStatus&&this.wrap&&(this.pTime=1e3*e,this.cTime=1e3*e,this.clear(),t&&this.refresh())},e.prototype.refresh=function(){this.clear();for(var e=this.pTime/1e3,t=0;t<this.dmList.length;t++)this.dmList[t].stime<e&&this.dmList[t].stime+this.dmList[t].duration>e&&this.drawDanmaku(this.dmList[t],e-this.dmList[t].stime);for(t=0;t<this.testDanmakus.length;t++)this.testDanmakus[t].stime<e&&this.testDanmakus[t].stime+this.testDanmakus[t].duration>e&&this.drawDanmaku(this.testDanmakus[t],e-this.testDanmakus[t].stime)},e.prototype.visible=function(e){e!==this.visibleStatus&&(e?(this.visibleStatus=!0,this.refresh(),this.render()):(this.visibleStatus=!1,this.clear()))},e.prototype.clear=function(){this.inited&&(this.cdmList=[],this.wrap&&(this.wrap.innerHTML=""))},e.prototype.resize=function(e,t){if(void 0===e&&(e=this.resolutionWidth),void 0===t&&(t=this.resolutionHeight),this.resolutionWidth=e,this.resolutionHeight=t,this.inited){var r=this.container.offsetWidth,a=this.container.offsetHeight;a/t<r/e?(this.wrap.style.width=a/t*e/r*100+"%",this.wrap.style.height="100%"):(this.wrap.style.width="100%",this.wrap.style.height=r/e*t/a*100+"%")}this.refresh()},e}();t.default=c}]).default});